	\documentclass[a4paper,  review, authoryear, 1p.]{elsarticle}
	\usepackage[utf8]{inputenc}
	\usepackage[T1]{fontenc}
	%\usepackage[spanish]{babel}
	\usepackage{amsmath}
	\usepackage{amsfonts}
	\usepackage[normalem]{ulem}
	\usepackage{amssymb}
	\usepackage{graphicx}
	\usepackage{mathtools,amssymb}
	\usepackage{subfigure}
	\usepackage{optidef}
	\usepackage{xcolor}
	\usepackage[normalem]{ulem}
	\usepackage{amsthm}
	\usepackage{comment}
	%\usepackage[numbers]{natbib}
	\usepackage{tikz}
	\usepackage{pgfplots}
	\usepackage{mathrsfs}
	\usepackage{float}
	\usepackage{bm}
	%\usepackage{booktabs}
	\usepackage{bigstrut}
	\usepackage[linesnumbered,ruled,vlined]{algorithm2e}
	%\usepackage[noend]{algpseudocode}
	%\usepackage{ulem}
	\usepackage[margin=1in]{geometry}
	\usepackage{enumitem}
	\usepackage{mathrsfs}
	\usepackage{xspace}
	\usepackage{array}
	\usepackage{multirow}
	\usepackage{colortbl}
	\setlength{\extrarowheight}{.5ex}
	
	
	\usepackage{threeparttable}
	
	\usepackage[utf8]{inputenc}
	
	
	
	\DeclareMathOperator*{\argmax}{arg\,max}
	\DeclareMathOperator*{\argmin}{arg\,min}
	
	
	\newcommand{\SPPN}{{\sf{H-SPPN}\xspace }}
	\newcommand{\TSPN}{{\sf{H-TSPN}\xspace }}
	\newcommand{\TSPVN}{{\sf{H-TSPVN}\xspace }}
	\newcommand{\B}{{\mathcal B}}
	\newcommand{\VB}{{V^{}_{\mathcal B}}}
	\newcommand{\EB}{{E^{}_{\mathcal B}}}
	\newcommand{\VS}{{V^{}_{S}}}
	\newcommand{\ES}{{E^{}_{S}}}
	\newcommand{\VT}{{V^{}_{T}}}
	\newcommand{\ET}{{E^{}_{T}}}
	\newcommand{\VN}{{V^{}_{\mathcal N}}}
	\newcommand{\EN}{{E^{}_{\mathcal N}}}
	\newcommand{\GSPP}{{G_{\text{SPP}}}}
	\newcommand{\VSPP}{{V_{\text{SPP}}}}
	\newcommand{\ESPP}{{E_{\text{SPP}}}}
	\newcommand{\GTSP}{{G_{\text{TSP}}}}
	\newcommand{\VTSP}{{V_{\text{TSP}}}}
	\newcommand{\ETSP}{{E_{\text{TSP}}}}
	\newcommand{\VSS}{{V^*_S}}
	\newcommand{\ESS}{{E^*_S}}
	\newcommand{\VTS}{{V^*_T}}
	\newcommand{\ETS}{{E^*_T}}
	\newcommand{\VNS}{{V^*_{\mathcal N}}}
	\newcommand{\ENS}{{E^*_{\mathcal N}}}
	\newcommand{\GSPPS}{{G^{*}_{\text{SPP}}}}
	\newcommand{\VSPPS}{{V^{*}_{\text{SPP}}}}
	\newcommand{\ESPPS}{{E^{*}_{\text{SPP}}}}
	\newcommand{\GTSPS}{{G^{*}_{\text{TSP}}}}
	\newcommand{\VTSPS}{{V^{*}_{\text{TSP}}}}
	\newcommand{\ETSPS}{{E^{*}_{\text{TSP}}}}
	
	\newtheorem{remark}{Remark}
	\newtheorem{notation}{Notation}
	
	\newtheorem{prop}{Proposition}
	
	\definecolor{armygreen}{rgb}{0.19, 0.53, 0.43}
	\definecolor{atomictangerine}{rgb}{1.0, 0.6, 0.4}
	\newcommand{\JP}[1]{{\color{armygreen}#1}}
	\newcommand{\CV}[1]{{\color{atomictangerine}#1}}
	\newcommand{\segment}[2]{\overline{#1#2}}
	\newcommand{\determinant}[3]{\det({#1|#2#3})}
	
	\begin{document}
		
		\begin{frontmatter}
			
			\title{The Hampered Traveling Salesman Problem with Neighbourhoods}
			
			\author[1]{Justo Puerto\corref{cor1}}%
			\ead{puerto@us.es}
			\author[2]{Carlos Valverde\corref{cor1}}
			\ead{cvalverde@us.es}
			
			\address[1]{Department of Statistics and Operations Research, University of Seville, Seville, 41012, Spain}
			\address[2]{Department of Statistics and Operations Research, University of Seville, Seville, 41012, Spain}
			
			\cortext[cor1]{Equally contributing authors}
			
			\date{\today}
			
			
			\begin{abstract}
				This paper deals with two different route design problems in a continuous space with neighbours and barriers: the shortest path and the traveling salesman problems with neighbours and barriers. Each one of these two elements, neighbours and barriers, make the problems harder than their standard counterparts. Therefore, mixing both together results in a new challenging problem that, as far as we know, has not been addressed before but that has applications for inspection and surveillance activities and the delivery industry assuming uniformly distributed demand in some regions.
				We provide exact mathematical programming formulations for both problems assuming polygonal barriers and neighbours that are second-order cone (SOC) representable. These hypotheses give rise to mixed integer SOC formulations that we preprocess and strengthen with valid inequalities. The paper also reports computational experiments showing that our exact method can solve instances with 80 neighbourhoods and a range between 125-145 barriers.
			\end{abstract}
			
			\begin{keyword}
				Routing \sep Traveling salesman \sep Networks \sep Conic programming and interior point methods
			\end{keyword}
			
		\end{frontmatter}
		
		\section{Introduction}
		Routing problems are considered classical problems in the core of combinatorial optimisation. Among them, the Traveling Salesman Problem (TSP) is one of its more important representatives and it has been studied extensively in many different forms. The problem is well-known to be NP-hard. Its analysis has led in the last decades  to methodological advances and new optimisation techniques that have allowed solving real life instances that few years ago were beyond solvable limits. The TSP has been studied in its geometric and pure combinatorial forms because of its algorithmic and practical implications. One very interesting extension arises when we require the tour to visit a set of regions rather than points. This version of the problem is called the TSP with Neighbours (see  \citet{arkin_approximation_1994}) which is APX-hard to approximate even for regions that are (intersecting) line segments.  They can represent regions that the drone must reach and where the customers are willing to pick up the orders (they can be seen as uniform probability densities) in the delivery industry. Moreover, they can be also used for modelling some areas that must be inspected by the drone (whenever visiting a point of these areas is enough to consider them as inspected).  On the other hand, the graphic TSP (see \citet{moemke_approximating_2011}), where distances are measures by geodesics (shortest paths in the respective metric space), has also attracted the attention of many researchers since it models, in a natural way, TSP routes among forbidden barriers, robot motion planning and automatic navigation in computer games. 
		
		For the above mentioned reasons, it is very important to analyze the mathematical implications of barriers to the geometry and computation of routes in a continuous space. Beyond the mathematical relevance by the intrinsic difficulty of the resulting models (non-convexities), the importance of this topic also comes from its many real life applications and more specifically in drone delivery with uniformly distributed demand and drone inspection and surveillance in urban areas with buildings or similar barriers.  Most of the classical methods in route design are based on an underlying network structure. Our approach is essentially different since, on top of assuming the existence of barriers, we also assume that the location of targets to be visited are uniformly distributed in neighbourhoods giving rise to challenging  problems in the continuous space. Nevertheless, the resulting problems still keep geometric elements that must be exploited to partially overcome the difficulties of the solution approaches and algorithms in the design of routes among neighbourhoods with barriers.
		
		The well-known Traveling Salesman Problem with Neighbourhoods (TSPN) was introduced by \citet{arkin_approximation_1994}. These authors adressed this problem by proposing heuristic procedures that construct tours and prove that the length of these tours is within a constant factor of the length of an optimal tour. In \citet{gentilini_travelling_2013}, authors formulate this problem as a non-convex mixed-integer nonlinear program (MINLP) that yields a convex nonlinear program when the discrete variables are fixed. Moreover, \citet{yuan_towards_2017} combine strategically metaheuristics and classical TSP solvers to produce high quality solutions for the TSPN with arbitrary neighbourhoods. In \citet{glock_spatial_2022}, the concept of spatial coverage in routing and path planning is unified and defined and a categorization scheme of related problems is introduced. Other classical combinatorial problems as the Minimum Spanning Tree (MST) or the Crossing Postman Problem (XPP) that have been  extended to deal with neighbourhoods are developed in \citet{blanco_minimum_2017} and \citet{puerto_routing_2022}, respectively. 
		
		As far as we are concerned, the use of barriers in location problems has been widely considered (see \citet{klamroth_single-facility_2002}) but the corresponding routing problem with barriers  has attracted less attention in the Operations Research field. In spite of that, one can find connections with some problems in the area of computational geometry as the shortest path problem in polygons and the touring polytopes problem (see \citet{mitchell_shortest_2017}), in navigation games competition  as for instance the Physical Traveling Salesman Problem (see \citet{perez_solving_2014}), or in robot motion planning (see \citet{hwang_potential_1992} and \citet{laumond_motion_1994}).  Different complexity results are known and a lot of effective heuristic algorithms are developed for specific classes of problems. However, as far as we know, in all cases targets are points and no exact algorithms are provided. Moreover, at times, these problems can appear as  subproblems of some other combinatorial problems so that one would like to embed them into some mathematical programming formulation. Nevertheless, we are not aware of any mathematical programming formulation for these problems that permits it to be considered as a building block of more complex/integrated problems in real life applications, even without requiring target to be neighbourhoods.
		
		Our goal  in this paper is to deal with the TSP with Neighbourhoods and barriers that we call the Hampered Traveling Salesman with Neighbourhoods (\TSPN ). As commented above each one of these two elements (neighbourhoods and barriers) make the problem hard. Thus, mixing both together results in a new problem that, as far as we know, has not been addressed before but that has a lot of applications in the delivery industry and inspection and surveillance activities, as justified previously. Moreover, it also has implications from the methodological point of view because introduces non-fixed elements in network representation and the issue of obtacles (barriers) in the solution space in the same problem.
		
		Our contribution is to provide exact mathematical programming formulations for the problem assuming polygonal barriers and neighbourhoods that are second-order cone (SOC) representable. These hypotheses give rise to mixed-integer SOC formulations that we preprocess and strengthen with valid inequalities. In our way to the formulations we deal with the associated Hampered Shortest Path Problem with Neighbourhoods (\SPPN ) which is used as a building block for the more difficult \TSPN . In spite that we prove that the \SPPN \ is polynomially solvable, we also give a formulation for this problem which highlights the constraints that are necessary for the \TSPN. The respective \TSPN \ is NP-hard. We give exact formulations using a geodesic shortest path representation that allows to solve medium size instances of this class of problems. Our computational tests show the difficulty of handling barriers and neighbourhoods together  but also that our formulation is useful for problems with 80 neighbourhoods and a range between 125-145 barriers.
		
	
			The paper is organized in 8 sections. The first section is the introduction. In the second section, the problems to be dealt with are described and the notation followed in the rest of the paper is set. Section \ref{section:formulations} develops formulations for the problems defined in the manuscript. These initial formulations are later reformulated using finite dominating sets described along the paper.
			Section \ref{section:strengthening}  strengthens these formulations  by preprocessing variables, developing  families of  valid inequalities to be added to the formulations and proposing some variable fixing strategies. A computational experience is reported in Section \ref{section:experiments}. The paper ends with a section devoted to conclusions and extensions, where some interesting further research connected with the problems addressed in this paper is discussed.
		
		
		\section{Preliminaries and Problems'  Description \label{section:description}}
		This section is devoted to setting the hypothesis that describe the framework where we analyze the considered problems.
		We will deal with two problems in this paper: the Hampered Shortest Path Problem with Neighbourhoods \SPPN \ and the Hampered Traveling Salesman Problem with Neighbourhoods \TSPN. Since we have in mind their applications to the drone delivery problem with uniformly distributed demand in regions and inspection problems, at times, we will refer to the moving object as the \textit{drone}. In both considered problems, we denote by $\mathcal{B}$ the set of line segments that model the barriers and we adopt the  assumptions that are listed below.
		
		\begin{enumerate}[label=\textbf{A\arabic*},ref=\textbf{A\arabic*}]
			\item \label{A1}The line segments of $\mathcal B$ are located in general position, i.e., the endpoints of these segments are not aligned. Although it is possible to model the most general case, one can always  slightly modify one of the endpoints so that the segments are in general position.
			\item The line segments of $\mathcal B$ are open sets, that is, it is possible that the drone visits  endpoints of segments, but entering  in its interior is not allowed. Observe that without loss of generality, we can always slightly enlarge these segments to make them open.
			\item  If there are two overlapping barriers, we assume that there is only one barrier given by the union of them.
			\item \label{A4}There is no rectilinear path joining two neighbourhoods without crossing an obstacle.
		\end{enumerate}
		
		%In \SPPN, we have a source neighbourhood $N_S\subset\mathbb R^2$ and a target neighbourhood $N_T\subset\mathbb R^2$, that we assume to be convex sets and a set $\mathcal B$ of opened line segments located in general position that plays the role of barriers that the drone cannot cross, i.e., the drone can visit the endpoints of these barriers but it cannot be located in the interior points of the barriers. Note that, it is rational to assume that if there are two barriers that have a portion of them in common, it is only considered the smallest line segment that contains both barriers. The aim of the \SPPN is to find the best pair of points $(P_{S}, P_{T})\in N_S\times N_T$ in the source and target neighbourhoods that minimize the length of the path that joins both points without crossing any barrier of $\mathcal B$. In this problem, it is implicitly assumed that there is not a rectilinear path to go from $N_S$ to $N_T$, otherwise, the problem becomes straightforward and the solution is the minimum distance between both neighbourhoods. 
		
		To simplify the presentation, we introduce some general notation used along the paper.
		\subsubsection*{Notation} 
		
		The following terminology clarifies the notation applied throughout the paper: 
		\begin{itemize}
			\item $P$ and $Q$ are referred to as generic points that, at the same time, are identified with their coordinates $P=(P_x, P_y)$ and $Q=(Q_x, Q_y)$, respectively.
			\item Given two points $P^1$ and $P^2$, the line segment joining $P^1$ and $P^2$ is denoted by $\segment{P^1}{P^2}$. It can be parameterized as follows:
			$$\segment{P^1}{P^2}=\{P\in\mathbb R^2:P=\lambda P^1 + (1-\lambda)P^2,\,\lambda\in[0,1]\}.$$
			\item  Given two points $P^1$ and $P^2$, the edge whose vertices are $P^1$ and $P^2$ is denoted by $(P^1, P^2)$.
			\item  Given two points $P^1$ and $P^2$, the vector pointing from $P^1$ to $P^2$ is denoted by $\overrightarrow{P^1P^2}$. It is computed as
			$\overrightarrow{P^1P^2}=P^2-P^1.$
			\item Given three points $P^1$, $P^2$ and $P^3$, $\determinant{P^1}{P^2}{P^3}$ denotes the following determinant:
			$$
			\determinant{P^1}{P^2}{P^3}=\det\left(\begin{array}{c|c} \overrightarrow{P^1P^2} & \overrightarrow{P^1P^3}\end{array}\right):=\det\left( \begin{array}{cc}  P^2_x-P^1_x & P^3_x-P^1_x \\ P_y^2-P^1_y & P_y^3-P_y^1 \end{array}\right).
			$$
			The sign of $\determinant{P^1}{P^2}{P^3}$ gives the orientation of the point $P^1$ with respect to the line segment $\segment{P^2}{P^3}.$ Note that $\determinant{P^1}{P^2}{P^3}\neq 0$ by \ref{A1}. 
		\end{itemize}
		
		
		\subsection{Description of the Hampered Shortest Path Problem with Neighbourhoods}\label{subsection:descriptionHSPPN}
		In \SPPN, we have a source neighbourhood $N_S\subset\mathbb R^2$ and a target neighbourhood $N_T\subset\mathbb R^2$, that we assume to be second-order cone representable sets and a set $\mathcal B$ of line segments that play the role of barriers that the drone cannot cross. 
		
		The goal of the \SPPN \ is to find the best pair of points $(P_{S}, P_{T})\in N_S\times N_T$ in the source and target neighbourhoods that minimize the length of the path that joins both points without crossing any barrier of $\mathcal B$ and assuming \ref{A1}-\ref{A4}. To state the model,  we define the following sets:
		\begin{itemize}
			\item $\VS=\{P_S\}$. Set composed by the point selected in the source neighbourhood $N_S$.
			\item $\VB=\{P^1_B, P^2_B:B=\overline{P^1_B P^2_B}\in \mathcal B\}$. Set of vertices that come from the endpoints of barriers in the problem.
			\item $\VT=\{P^{}_T\}$. Set composed by the point selected in the target neighbourhood $N_T$.
			\item $\ES=\{(P_S, P^i_{B}):P^i_B\in V_\B\text{ and } \overline{P_SP^i_B}\cap B''=\emptyset,\forall B''\in\B,\:i=1,2\}$. Set of edges formed by the line segments that join the point selected in the source neighbourhood $N_S$ and every endpoint in the barriers that do not cross any other barrier in $\B$.
			\item $\EB=\{(P^{i}_B, P^{j}_{B'}):P^i_B, P^j_{B'}\in \VB \text{ and } \overline{P^i_B P^j_{B'}}\cap B''=\emptyset,\:\forall B''\in\mathcal B,\:i, j=1,2\}$. Set of edges formed by the line segments that join two vertices of $V_{\mathcal B}$ and do not cross any other barrier in $\B$.
			\item $\ET=\{(P^i_{B}, P^{}_T):P^i_B\in V_\B\text{ and } \overline{P^i_BP^{}_T}\cap B''=\emptyset,\forall B''\in\B,\:i=1,2\}$. Set of edges formed by the line segments that join the point selected in the target neighbourhood $N_T$ and every endpoint in the barriers that do not cross any other barrier in $\B$.
		\end{itemize} 
		
		The above sets allow us to define the graph $\GSPP= (\VSPP, \ESPP)$ induced by the barriers and neighbourhoods, where $\VSPP=\VS\cup \VB\cup\VT$ and $\ESPP=\ES\cup\EB \cup\ET$. 
		%	It is interesting to note that this graph can be split into two parts: a fixed graph $G_\B=(\VB,\EB)$ whose edges can be computed by using the Remark \ref{rem:determinants} and the sets $\VS$, $\ES$, $\VT$ and $\ET$ that depend on where the points $P_S$ and $P^{}_T$ are located as shown in Figure \ref{fig:graph}.  The \CV{two subfigures} show how the graph $G$ is generated. The blue dashed line segments represent the edges of $\ES$, the green ones, the edges of $\ET$ and the red dashed lines, the edges of $\EB$. A special case that can be remarked occurs when the neighbourhoods are points. In that case, the induced graph is completely fixed and it is only necessary to find which edges are included by keeping in mind that there can not have crossings. This idea is exploited in Subsection \ref{section:reformulation}.
		
		%\textcolor{red}{Me estoy dando cuenta que nos pueden decir que para qué tenemos en cuenta todo el conjunto si realmente se pueden coger los puntos de la frontera mas cerca a cada uno de los puntos por donde puede salir de las barreras. Es cierto que solo ocurre con el SPP. En el caso del TSP esto no es cierto.}
		
		%	\input{figures/Example_ H-SPP-S_ Second Figure A}
		
		
		\subsection{Description of the Hampered Traveling Salesman Problem with Neighbourhoods\label{ssec:TSPN}}
		The \TSPN \ is an extension of the \SPPN \ where the neighbourhood set $\mathcal N$ is considered to play the role of source and target  in the \SPPN \ and moreover, a set of given targets must be visited. The aim of the \TSPN \  is to seek for the shortest tour that visits each neighbourhood $N\in\mathcal N$ exactly once without crossing any barrier $B\in\mathcal B$ and assuming again \ref{A1}-\ref{A4}. 
		
		To present our formulation for the \TSPN, the graph induced by the endpoints of the barriers and the neighbourhoods is different from the previous one for the \SPPN. For its description, we introduce the following sets:
		
		\begin{itemize}
			\item $\VN=\{P_N:N\in\mathcal N\}$. Set of the points selected in the neighbourhoods $\mathcal N$ to be visited.
			\item $\VB=\{P^1_B, P^2_B:B=\overline{P^1_B P^2_B}\in \mathcal B\}$. Set of vertices of the barriers of the problem.
			\item $\EN=\{(P_N, P^i_{B}):P^i_B\in V_\B\text{ and } \overline{P_NP^i_B}\cap B''=\emptyset,\forall B''\in\B,\:i=1,2\}$. Set of edges formed by the line segments that join each point selected in the neighbourhoods of $\mathcal N$ with every endpoint in the barriers and do not cross any barrier in $\B$.
			\item $\EB=\{(P^{i}_B, P^{j}_{B'}):P^i_B, P^j_{B'}\in \VB \text{ and } \overline{P^i_B P^j_{B'}}\cap B''=\emptyset,\:\forall B''\in\mathcal B,\:i, j=1,2\}$. Set of edges formed by the line segments that join two vertices of $V_{\mathcal B}$ and do not cross any barrier in $\B$.
		\end{itemize} 
		
		Following the same idea as before, we consider the graph $\GTSP=(\VTSP,\ETSP)$ induced by the barriers and neighbourhoods, where $\VTSP=\VN\cup\VB$ and $\ETSP=\EN\cup\EB$.
		
		Note that, in this case, it may be also interesting to consider this problem without imposing assumption \ref{A4}. This more general version is called the Hampered Traveling Salesman Problem with Visible neighbourhoods \TSPVN. In this case, we do not require that the barriers separate neighbourhoods completely, i.e., when moving from one neighbourhood to another one it is possible to go following a straight line without crossing any barrier. The main difference lies in the description of edges for the graph induced by the neighbourhoods and endpoints of barriers.
		
		By taking the same approach, the sets that describe the graph in this case are:
		
		\begin{itemize}
			\item $\VN=\{P_N:N\in\mathcal N\}$. Set of points in the neighbourhoods $\mathcal N$ that must be visited.
			\item $\VB=\{P^1_B, P^2_B:B=\overline{P^1_B P^2_B}\in \mathcal B\}$. Set of vertices of the barriers of the problem.
			\item $V_{\rm TSPV} = \VN \cup \VB$.
			\item $E_{\rm TSPV}=\{(P, P'):P, P' \in V_{TSP} \text{ and } \overline{PP'}\cap B''=\emptyset,\forall B''\in\B\}$. Set of edges formed by the line segments that join every pair of points in $V_{TSP}$ that do not cross any barrier.
		\end{itemize} 
		
		Figure \ref{fig:initialdata} shows an example of each one of the three problems that are being considered. The left picture shows an instance of the \SPPN, where the blue neighbourhood represents the source, the green one the target and the red line segments show the barriers that the drone cannot cross. In the center picture, an instance of the \TSPN \  is shown, where the neighbourhoods are balls and the barriers are, again, the red line segments. Finally, the right most picture illustrates an instance of the \TSPVN \ where the orange and blue balls can be joined by a rectilinear path.
		
		\input{figures/Example_ H-SPP-S_ First Figure}
		
		\section{MINLP Formulations}\label{section:formulations}
		
		This section proposes a mixed-integer NonLinear Programming formulation for the problems described in Section \ref{section:description}. First of all, we present the conic programming representation of the neighbourhoods and distance. Then,  we set the constraints that check if a segment is included in the set of edges $E_X$ with $X\in \{SPP, TSP, TSPV\}$. Finally, the formulations for the \SPPN, \TSPN \ and \TSPVN \ are described.
		
		We would like to remark that having a mathematical programming representation for the \SPPN \ is very important even though we will prove in the following that this problem can be solved with a combinatorial algorithm in polynomial time. Indeed, we will need that type of representation to address some NP-hard problems that require computing shortest paths as building blocks, as for instance the location problem with barriers and 
		neighbours and the \TSPN . Therefore, we will start providing two different mathematical programming formulations for the \SPPN \ able to be embedded in more complex problems.
		
		
		First of all, we introduce the decision variables that represent the problem. These are summarized in Table \ref{table:variables}.
		
		\begin{table}[h!]
			\centering
			\caption{Summary of decision variables used in the mathematical programming model}
			\label{table:variables}
			\begin{tabular}{|cl|l}
				\cline{1-2}
				\multicolumn{2}{|l|}{\textbf{Binary Decision Variables}} &  \\ \cline{1-2}
				\multicolumn{1}{|l|}{\textbf{Name}} & \textbf{Description} &  \\ \cline{1-2}
				\multicolumn{1}{|c|}{$\alpha(P|QQ')$} & \begin{tabular}[c]{@{}l@{}}1, if the determinant $\det(P|QQ')$ is positive,\\ 0, otherwise.\end{tabular} &  \\ \cline{1-2}
				\multicolumn{1}{|c|}{$\beta(PP'|QQ')$} & \begin{tabular}[c]{@{}l@{}}1, if the determinants $\det(P|QQ')$ and $\det(P'|QQ')$ have the same sign,\\ 0, otherwise.\end{tabular} &  \\ \cline{1-2}
				\multicolumn{1}{|c|}{$\gamma(PP'|QQ')$} & \begin{tabular}[c]{@{}l@{}}1, if  the determinants $\det(P|QQ')$ and $\det(P'|QQ')$ are both positive,\\ 0, otherwise.\end{tabular} &  \\ \cline{1-2}
				\multicolumn{1}{|c|}{$\delta(PP'|QQ')$} & \begin{tabular}[c]{@{}l@{}}1, if the line segments $\overline{PP'}$ and $\overline{QQ'}$ intersect,\\ 0, otherwise.\end{tabular} &  \\ \cline{1-2}
				\multicolumn{1}{|c|}{$\varepsilon(PP')$} & \begin{tabular}[c]{@{}l@{}}1, if the line segment $\overline{PP'}$ does not cross any barrier,\\ 0, otherwise.\end{tabular} &  \\ \cline{1-2}
				\multicolumn{1}{|c|}{$y(PQ)$} & \begin{tabular}[c]{@{}l@{}}1, if the edge $(P, Q)$ is selected in the solution of the model,\\ 0, otherwise.\end{tabular} &  \\ \cline{1-2}
				\multicolumn{2}{|l|}{\textbf{Continuous Decision Variables}} & \multicolumn{1}{c}{\textbf{}} \\ \cline{1-2}
				\multicolumn{1}{|l|}{\textbf{Name}} & \textbf{Description} &  \\ \cline{1-2}
				\multicolumn{1}{|c|}{$P_N$} & Coordinates representing the point selected in the neighbourhood $N$. &  \\ \cline{1-2}
				\multicolumn{1}{|c|}{$d(PQ)$} & Euclidean distance between the points $P$ and $Q$. &  \\ \cline{1-2}
				\multicolumn{1}{|c|}{$g(PQ)$} & Amount of commodity passing through the edge $(P, Q)$. &  \\ \cline{1-2}
			\end{tabular}
		\end{table}
		
		\subsection{Conic programming constraints in the models}
		 In the two considered  problems, namely \SPPN \ and \TSPN, there exist two second-order cone constraints that model the distance between  pair of points $P$ and $Q$, as well as the representation of neighbourhoods where the points can be chosen.
		
		\newcommand{\dvar}[2]{d(#1#2)}
		
		For modelling of the distance between pair of points, we introduce the non-negative continuous variable $\dvar{PQ}$ that represents the distance between $P$ and $Q$:
		
		
		\begin{equation*}\tag{d-C}\label{eq:dC}
			\|P - Q\|\leq \dvar{P}{Q},\quad\forall (P,Q)\in E_X,
		\end{equation*}
		
		where $E_X$ is the set of edges $\ESPP$, $\ETSP$ or $E_{\rm{TSPV}}$.
		
		For the representation of neighbourhoods where points can be chosen, since we are assuming that the neighbourhoods are second-order cone (SOC) representable, they can be expressed by means of the constraints:
		
		\begin{equation*}\tag{N-C}\label{eq:nC}
			P_N\in N \Longleftrightarrow
			\|A_N^i P_N + b_N^i\| \leq (c_N^i)^T P_N + d_N^i,\quad i=1,\ldots,nc_N, \\
		\end{equation*}
		%\begin{equation}\label{C-C}\tag{$\mathcal{C}$-C}
		%    \|B_ix + b_i\|\leq c_i^Tx + d_i,\quad i=1,\ldots,N,
		%\end{equation}
		where $A_N^i, b_N^i, c_N^i$ and $d_N^i$ are parameters of the constraint $i$ and $nc_N$ denotes the number of constraints that appear in the block associated with the neighbourhood $N$.
		
		It is remarkable that these inequalities can model the special case of linear constraints (for $A_N^{i}, b_N^i\equiv 0$), ellipsoids and hyperbolic constraints (see \citet{lobo_applications_1998} and \citet{boyd_convex_2004} for more information).
		
		%	\textcolor{red}{Puede ser muy interesante el caso 3D pero quizás en otro trabajo, no?}
		
		\subsection{Checking whether a segment is an edge of the induced graph}
		
		The goal of this subsection is to give a test to check whether given two arbitrary vertices $P, Q\in V_X$, the edge $(P, Q)\in E_X$, with $X\in\{SPP, TSP, TSPV\}$, i.e., whether the line segment $\overline{PQ}$ does not intersect with any barrier of $\mathcal B$. The following well-known computational geometry result can be used to check if two line segments intersect.
		
		
		\begin{remark}\label{rem:determinants}
			Let $\overline{PQ}$ and $B=\overline{P_B^1P_B^2}\in\mathcal B$ be two different line segments. 
			%		Let also denote 
			%		$$
			%		\determinant{P}{P_B^1}{P_B^2}=\det\left(\begin{array}{c|c} \overrightarrow{PP_B^1} & \overrightarrow{PP_B^2}\end{array}\right):=\det\left( \begin{array}{cc}  P_{B_x}^1-P_x & P_{B_x}^2-P_x \\ P_{B_y}^1-P_y & P_{B_y}^2-P_y \end{array}\right)$$ 
			%		the determinant whose arguments are $P=(P_x,P_y)$, $P_B^1=(P_{B_x}^1,P_{B_y}^1)$ and $P_B^2=(P_{B_x}^2,P_{B_y}^2)$. 
			If
			\begin{equation*}
				\normalfont{\text{sign}}\left(\determinant{P}{P_B^1}{P_B^2}\right) = \normalfont{\text{sign}}\left(\determinant{Q}{P_B^1}{P_B^2}\right)
				\quad
				\text{or}
				\quad
				\normalfont{\text{sign}}\left(\determinant{P_B^1}{P}{Q}\right) = \normalfont{\text{sign}}\left(\determinant{P_B^2}{P}{Q}\right)
				,
			\end{equation*}
			then $\overline{PQ}$ and $B$ do not intersect.
		\end{remark}
		
		
		%	\input{figures/Example_ H-SPP-S_ Second Figure B}
		
		
		Let $P,Q\in V_X$, where $V_X$ denotes the set of vertices $\VSPP$, $\VTSP$ or $V_{\rm{TSPV}}$. It is essential to model the conditions of the Remark \ref{rem:determinants} by using binary variables that check the sign of determinants, the equality of signs, and the disjunctive condition, since these determinants depend on the location of $P$ and $Q$.
		
		\newcommand{\LS}[3]{L(#1|#2#3)}
		\newcommand{\US}[3]{U(#1|#2#3)}
		\newcommand{\alphamas}[3]{\alpha(#1|#2#3)}
		\newcommand{\alphamenos}[3]{\alpha^{-}(#1|#2#3)}
		%\newcommand{\alphacero}[3]{\alpha^{0\,}(#1|#2#3)}
		\newcommand{\alphapunto}[3]{\alpha^{\cdotp}(#1|#2#3)}
		
		To model the sign of each determinant in Remark \ref{rem:determinants}, we introduce the binary variable $\alpha$, that assumes the value one if the determinant is positive and zero, otherwise. Note that the case when determinants are null does not need to be considered, because the segments are located in general position.
		
		It is possible to represent the sign condition by including the following constraints:
		\begin{align*}\tag{$\alpha$-C}\label{eq:alphaC}
			\left[1-\alphamas{P}{P_B^1}{P_B^2}\right]\LS{P}{P_B^1}{P_B^2}&\leq\determinant{P}{P_B^1}{P_B^2}\leq \US{P}{P_B^1}{P_B^2}\:\alphamas{P}{P_B^1}{P_B^2},\\
			\left[1-\alphamas{Q}{P_B^1}{P_B^2}\right]\LS{Q}{P_B^1}{P_B^2}&\leq\determinant{Q}{P_B^1}{P_B^2}\leq \US{Q}{P_B^1}{P_B^2}\:\alphamas{Q}{P_B^1}{P_B^2},\\
			\left[1-\alphamas{P_B^1}{P}{Q}\right]\LS{P_B^1}{P}{Q}&\leq\determinant{P_B^1}{P}{Q}\leq \US{P_B^1}{P}{Q}\:\alphamas{P_B^1}{P}{Q},\\		\left[1-\alphamas{P_B^2}{P}{Q}\right]\LS{P_B^2}{P}{Q}&\leq\determinant{P_B^2}{P}{Q}\leq \US{P_B^2}{P}{Q}\:\alphamas{P_B^2}{P}{Q},
		\end{align*}
		
		\noindent where $L$ and $U$ are lower and upper bounds for the value of corresponding determinants, respectively. If a determinant is positive, then $\alpha$ must be one to make the second inequality feasible. Analogously, if the determinant is not positive, $\alpha$ must be zero to enforce the correct condition.
		
		\newcommand{\betamas}[4]{\beta(#1#2|#3#4)}
		%\newcommand{\betamenos}[4]{\beta^{-}(#1#2|#3#4)}
		%\newcommand{\betacero}[4]{\beta^{0\,}(#1#2|#3#4)}
		%\newcommand{\betapunto}[4]{\beta^{\cdotp}(#1#2|#3#4)}
		
		Now, to check whether the pairs of determinants 
		\begin{equation}\label{eq:pair}
			\determinant{P}{P_B^1}{P_B^2},\: \determinant{Q}{P_B^1}{P_B^2}\quad \text{and} \quad \determinant{P_B^1}{P}{Q},\:	 \determinant{P_B^2}{P}{Q}
		\end{equation} 
		have the same sign, we introduce the binary variable $\beta$, that is one if the corresponding pair has the same sign, and zero otherwise.
		
		\newcommand{\gammaprod}[4]{\gamma(#1#2|#3#4)}
		
		Hence, the correct value of $\beta$ variable can be enforced by the following constraint of the $\alpha$ variables
		\begin{align*}%\tag{$\beta$-C}\label{eq:betaC}
			\betamas{P}{Q}{P_B^1}{P_B^2}&=\alphamas{P}{P_B^1}{P_B^2}\alphamas{Q}{P_B^1}{P_B^2} + \left[1-\alphamas{P}{P_B^1}{P_B^2}\right]\left[1-\alphamas{Q}{P_B^1}{P_B^2}\right],\\
			\betamas{P_B^1}{P_B^2}{P}{Q}&=\alphamas{P_B^1}{P}{Q}\alphamas{P_B^2}{P}{Q} + \left[1-\alphamas{P_B^1}{P}{Q}\right]\left[1-\alphamas{P_B^2}{P}{Q}\right].
		\end{align*}
		This condition can be equivalently written using an auxiliary binary variable $\gamma$ that models the product of the $\alpha$ variables:
		\begin{align*}\tag{$\beta$-C}\label{eq:betaC}
			\betamas{P}{Q}{P_B^1}{P_B^2}&=2\gammaprod{P}{Q}{P_B^1}{P_B^2} -\alphamas{P}{P_B^1}{P_B^2}-\alphamas{Q}{P_B^1}{P_B^2}+1,\\
			\betamas{P_B^1}{P_B^2}{P}{Q}&=2\gammaprod{P_B^1}{P_B^2}{P}{Q} -\alphamas{P_B^1}{P}{Q}-\alphamas{P_B^2}{P}{Q}+1,
		\end{align*}
		We observe that $\gamma$ can be linearized by using the following constraints:
		
		\begin{minipage}{.5\linewidth}
			\begin{align*}
				\gammaprod{P}{Q}{P_B^1}{P_B^2} & \leq \alphamas{P}{P_B^1}{P_B^2},\\
				\gammaprod{P}{Q}{P_B^1}{P_B^2} & \leq \alphamas{Q}{P_B^1}{P_B^2},\\
				\gammaprod{P}{Q}{P_B^1}{P_B^2} & \geq \alphamas{P}{P_B^1}{P_B^2} + \alphamas{Q}{P_B^1}{P_B^2} - 1,
			\end{align*}
		\end{minipage}
		\begin{minipage}{.5\linewidth}
			\begin{align*}\tag{$\gamma$-C}\label{eq:gammaC}
				\gammaprod{P_B^1}{P_B^2}{P}{Q} & \leq \alphamas{P_B^1}{P}{Q},\\
				\gammaprod{P_B^1}{P_B^2}{P}{Q} & \leq \alphamas{P_B^2}{P}{Q},\\
				\gammaprod{P_B^1}{P_B^2}{P}{Q} & \geq \alphamas{P_B^1}{P}{Q} + \alphamas{P_B^2}{P}{Q} - 1.
			\end{align*}
		\end{minipage}
		
		\bigskip
		
		\newcommand{\deltacheck}[4]{\delta(#1#2|#3#4)}
		
		Later, we need to check whether there exists any coincidence of the sign of determinants, so we define the binary variable $\delta$ that is one if segments do not intersect and zero, otherwise. This condition can be modelled by using the following disjunctive constraints:
		\begin{equation*}\tag{$\delta$-C}\label{eq:deltaC}
			\frac{1}{2}\left[\betamas{P}{Q}{P_B^1}{P_B^2}+\betamas{P_B^1}{P_B^2}{P}{Q}\right]\leq\deltacheck{P}{Q}{P_B^1}{P_B^2}\leq \betamas{P}{Q}{P_B^1}{P_B^2}+\betamas{P_B^1}{P_B^2}{P}{Q}.
		\end{equation*}
		Indeed, the above constraints state that if there exists a sign coincidence in any of the two pairs of determinants in \eqref{eq:pair} , then $\delta$ is one to satisfy the left constraint, and the right one is always fulfilled. However, if none of the signs of the pairs of determinants is the same, then the second constraint is zero and $\delta$ is null.
		
		Finally, we need to check that
		$$\overline{PQ}\cap B''=\emptyset,\quad \forall B''\in\B,\quad\Longleftrightarrow\quad \deltacheck{P}{Q}{P_{B''}^1}{P_{B''}^2}=1,\quad\forall B''\in\B.$$
		%Firstly, we will expose the constraints for two line segments $\segment{A}{B}$ and $\segment{C}{D}$ in general to model the previous remark. Afterwards, we will focus on the case for edges of $\ES$. 
		
		%Let $B\in\B$ a barrier and $P_B^i$ and endpoint of $B$. Hence, the edge $(P_S, P_B^i)$ belongs to $\ES$ if $\overline{P^{}_SP^i_B}\cap B'=\emptyset$, for all $B'\in\B$
		%or equivalently, by the Remark \ref{rem:determinants}:
		%\begin{equation*}
		%\normalfont{\text{sign}}\left(\determinant{P_S^{}}{P_{B'}^1}{P_{B'}^2}\right) = \normalfont{\text{sign}}\left(\determinant{P_B^i}{P_{B'}^1}{P_{B'}^2}\right)
		%\quad
		%\text{or}
		%\quad
		%\normalfont{\text{sign}}\left(\determinant{P^{}_S}{P_{B'}^1}{P_{B'}^2}\right) = \normalfont{\text{sign}}\left(\determinant{P_B^i}{P_{B'}^1}{P_{B'}^2}\right),
		%\quad\forall B'\in\B.
		%\end{equation*}
		%$$=\emptyset,\quad\forall B''\in\B,$$
		
		%However, if those segments intersect, we need to ensure that $\deltacheck{P_S^{}}{P_B^i}{P_{B'}^1}{P_{B'}^2}$ is zero. It can be done by inserting the term $\epsilon \deltacheck{P_S^{}}{P_B^i}{P_{B'}^1}{P_{B'}^2}$ in the objective function, where $\epsilon>0$ is a small value.
		\newcommand{\varepsilonvar}[2]{\varepsilon(#1#2)}
		% At this point, we will focus on the description of the edges of $\ES$.
		
		Hence, if we denote by $\varepsilonvar{P}{Q}$ the binary variable that is one if the previous condition is satisfied for all $B''\in\B$ and zero otherwise, this variable can be represented by means of the following inequalities:
		\begin{equation*}\tag{$\varepsilon$-C}\label{eq:varepsilonC}
			\left[\sum_{B''\in\mathcal B}\deltacheck{P}{Q}{P^1_{B''}}{P^2_{B''}}-|\mathcal B|\right] + 1\leq \varepsilonvar{P}{Q}\leq \frac{1}{|\B|}\sum_{B''\in\mathcal B}\deltacheck{P}{Q}{P^1_{B''}}{P^2_{B''}}.
		\end{equation*}
		If there is, at least, a barrier $B''\in\B$ that intersects the segment $\overline{PQ}$, then $\deltacheck{P}{Q}{P^1_{B''}}{P^2_{B''}}$ is zero and the second inequality enforces $\varepsilon$ to be zero because the right hand side is fractional and the first inequality is non-positive. Nonetheless, if no barrier intersects the segment $\segment{P}{Q}$, then $\varepsilon$ is equals to one, because the left hand side of the first inequality is one and the right hand side of the second inequality too. 
		
		Based on the above description, we can identify the set of actual edges of graph $G$ by means of the $\varepsilon$ variables as follows:
		$$ E_X = \{(P, Q):P,Q\in V_X\wedge\varepsilonvar{P}{Q}=1, P\neq Q\}, \quad X\in \{SPP,TSP,TSPV\}.$$
		
		This representation of $E_X$ with $X\in \{SPP,TSP,TSPV\}$ will be exploited in the formulations that are described in the following subsections. 
		
		
		It is interesting to note that $\EB$ is a fixed set whose edges can be computed by using the Remark \ref{rem:determinants}. Then, $\varepsilon$ variables can be prefixed in advance. However, edges in $E_X\setminus \EB$ depend on the points selected in the neighbourhoods as shown in Figure \ref{fig:graph}.  The two subfigures show how the graph $\GSPP$ is generated. The blue dashed line segments represent the edges of $\ES$, the green ones, the edges of $\ET$ and the red dashed lines, the edges of $\EB$. A special case that can be highlighted  occurs when the neighbourhoods, $N_S$ and $N_T$, are points. In that case, the induced graph is completely fixed and it is only necessary to find which edges are included by keeping in mind that the graph must be planar, i.e., without crossings. This idea is later exploited in Subsection \ref{section:reformulation}.
		
		\input{figures/Example_ H-SPP-S_ Second Figure A}
		%	\subsection{A formulation for the \SPPN}
		%	The main goal of the \SPPN\  is to solve a shortest path problem in the undirected graph induced by the endpoints of the barriers and the neighbourhoods. 
		%\input{figures/Example_ H-SPP-S_ Second Figure B}
		
		
		%\newcommand{\sign}{{\text{sign}}}
		
		
		%\newcommand{\determinant}[3]{\det({#1#2#3})}
		
		
		\subsection{A formulation for the \SPPN}
		The idea of the formulation of the \SPPN \ is to extend the classical formulation of the 	Shortest Path Problem by taking into account the description of the graph $\GSPP$ in Subsection \ref{subsection:descriptionHSPPN}.
		
		\newcommand{\yvar}[2]{y(#1#2)}
		
		The formulation describes the path that the drone can follow by taking into account the edges of the induced graph. Let $P, Q\in \VSPP$ and let $\yvar{PQ}$ be the binary variable that is one if the drone goes from $P$ to $Q$. Then, the inequalities 
		
		\begin{equation*}\tag{y-C}\label{eq:yC}
			\yvar{P}{Q}\leq \varepsilonvar{P}{Q},
		\end{equation*}
		assure that the drone can go from $P$ to $Q$ only if the segment $\segment{P}{Q}$ does not cross any barrier. 
		
		
		By taking into account the constraints explained in subsections above, the following MINLP formulation is valid for \SPPN.
		
		\begin{mini*}
			{}{\sum_{(P,Q)\in \ESPP}\dvar{P}{Q}\yvar{P}{Q}}
			{}{}\label{eq:Example1}\tag{H-SPPN}
			\addConstraint{\sum_{\{Q:(P, Q)\in \ESPP\}}\yvar{P}{Q}-\sum_{\{Q:(Q, P)\in \ESPP\}}\yvar{Q}{P}}{=\left\{
				\begin{array}{rl} 
					1, & \text{if } P\in\VS, \\
					0, & \text{if } P\in\VB, \\
					-1, & \text{if }P\in\VT.
				\end{array}
				\right.}
			\addConstraint{\eqref{eq:alphaC},\eqref{eq:betaC},\eqref{eq:gammaC},\eqref{eq:deltaC}}{\quad\forall P, Q\in \VSPP,\quad\forall P_B^1, P_B^2\in \VB}
			\addConstraint{\eqref{eq:varepsilonC}, \eqref{eq:yC}, \eqref{eq:dC}}{\quad\forall P, Q\in \VSPP}
			\addConstraint{\eqref{eq:nC}}{\quad\forall P\in \VS\cup\VT.}
			%		\addConstraint{\eqref{eq:betaC},\eqref{eq:deltaC},\eqref{eq:gammaC},\eqref{eq:varepsilonC},\eqref{eq:yC}}{ }
			%		\addConstraint{\eqref{eq:dC}, \eqref{eq:nC}.}{ }
		\end{mini*}
		
		The objective function minimizes the length of the path followed by the drone on the edges of the induced graph $\GSPP$. The first constraints are the flow conservation constraints that ensure the path is connected, the second constraints represent the sets $\ES$ and $\ET$ and the third ones state that the points selected must be in their respective neighbourhoods.
		
		\input{figures/Example_ H-SPP-S_ Solution}
		
		\subsubsection{Reformulating the \SPPN}\label{section:reformulation}
		The formulation for the \SPPN \ presented above can be simplified by taking into account the following observation.
		\begin{prop}
			There exists two finite dominating sets, $N_S^*$ and $N_T^*$, of possible candidates to be starting points in  $N_S$ and terminal points in $N_T$, respectively. Moreover,
			\begin{align*}
				N^*_S=\{P_S(P_B^i)&:P_S(P_B^i)=\argmin_{P_S\in N_S} \|P_S - P_B^i\|,\,(P_S, P_B^i)\in E_S\text{ and }P_B^i\in\VB\},\\
				N^*_T=\{P_T(P_B^i)&:P_T(P_B^i)=\argmin_{P_T\in N_T} \|P_B^i - P_T\|,\,(P_B^i, P_T)\in E_T\text{ and }P_B^i\in\VB\}.
			\end{align*} 
		\end{prop}
		\begin{proof}
			Note that the points chosen in $N_S$ and $N_T$ in an optimal solution for \SPPN \ must be those that give the minimum distances to the points of the first and last visited barriers in any optimal solution, respectively. Therefore, $N_S^*$ and $N_T^*$ must contain, at most, the points in the sets
			\begin{align*}
				\{P_S(P_B^i)&:P_S(P_B^i)=\argmin_{P_S\in N_S} \|P_S - P_B^i\|,\,(P_S, P_B^i)\in E_S\text{ and }P_B^i\in\VB\},\\
				\{P_T(P_B^i)&:P_T(P_B^i)=\argmin_{P_T\in N_T} \|P_B^i - P_T\|,\,(P_B^i, P_T)\in E_T\text{ and }P_B^i\in\VB\},
			\end{align*} 
			as claimed.
		\end{proof}
		\noindent
		Therefore, we can compute, \textit{`a priori'},  the sets $N_S^*$ and $N_T^*$ by solving a convex problem for each endpoint of the barriers:
		\begin{align*}
			N_S^*&=\{P_S(P_B^i):P_S(P_B^i)=\argmin_{P_S\in N_S} \|P_S - P_B^i\|\text{ and }\varepsilonvar{P_S}{P_B^i}=1\},\\
			N_T^*&=\{P_T(P_B^i):P_T(P_B^i)=\argmin_{P_T\in N_T} \|P_B^i - P_T\|\text{ and }\varepsilonvar{P_B^i}{P_T}=1\}.
		\end{align*}
		
		%	Moreover, the points chosen in the solution, $P_S$ and $P_T$, can be represented by \CV{the constraints \eqref{eq:nCs} for the point $P_S$ in $N_S$ and \eqref{eq:nCt} for $P_T$ in $N_T$}:
		
		%	\begin{minipage}{.5\linewidth}
			%	\begin{align*}\tag{N$_S^*$-C}\label{eq:nCs}
				%		P_S&=\sum_{P_B^i\in V_{\mathcal B}}\mu_S(P_B^i)P_S(P_B^i),\\
				%		1&=\sum_{P_B^i\in V_{\mathcal B}}\mu_S(P_B^i),\\
				%		\CV{\mu_S(P_B^i)}&\CV{\in\{0, 1\},\forall P_B^i\in\VB.}
				%	\end{align*}
			%	\end{minipage}
		%	\begin{minipage}{.5\linewidth}
			%	\begin{align*}\tag{N$_T^*$-C}\label{eq:nCt}
				%		P_T&=\sum_{P_B^i\in V_{\mathcal B}}\mu_T(P_B^i)P_T(P_B^i),\\
				%		1&=\sum_{P_B^i\in V_{\mathcal B}}\mu_T(P_B^i),\\
				%		\CV{\mu_T(P_B^i)}&\CV{\in\{0, 1\},\forall P_B^i\in\VB.}
				%	\end{align*}
			%	\end{minipage}
		
		\bigskip
		
		
		
		The graph required to address the new formulation makes use of the previous graph $\GSPP$ and then we augment new edges connecting the initial and terminal points $P_S\in N_S$ and $P_T\in N_T$, respectively, with the corresponding points in $N_S^*$ and $N_T^*$. Moreover, we also augment the edges connecting the points in the dominating sets with the extreme points of the segments where the minimal distances are attained. The reader may note that since the optimisation model minimizes the overall distance, in an optimal solution $P_S$ must belong to $N_S^*$ and $P_T$ to $N_T^*$.
		Therefore, the following sets are needed  to build the new graph induced by the dominating sets:
		\begin{itemize}
			\item $V_S^*=N^*_S$. Dominating set of points associated with the neighbourhood $N_S$.
			\item $V_T^*=N^*_T$. Dominating set of points associated with the neighbourhood $N_T$.
			\item $E^\text{int}_S=\{(P_S, P_S(P_B^i)):P_S\in\VS\text{ and }P_B^i\in \VB\}$. Set of edges joining the point selected $P_S\in N_S$ with each point $P_S(P_B^i)$ in the dominating set $N^*_S$.
			\item $E^\text{ext}_S=\{(P_S(P_B^i), P_B^i):P_B^i\in\VB\}$. Set of edges joining the point $P_S(P_B^i)$ with its respective $P_B^i$ in $\VB$. 
			\item $E^*_S=E^\text{int}_S\cup E^\text{ext}_S.$
			\item $E^\text{int}_T=\{(P_T(P_B^i), P_T):P_B^i\in \VB\text{ and }P_T\in\VT\}$. Set of edges joining each point $P_S(P_B^i)$ in the dominating set $N^*_S$ with the point selected $P_T\in N_T$. 
			\item $E^\text{ext}_T=\{(P_B^i, P_T(P_B^i)):P_B^i\in\VB$. Set of edges joining the point $P_B^i$ in $\VB$ with its respective $P_T(P_B^i)$. 
			\item $E^*_T=E^\text{int}_T\cup E^\text{ext}_T.$
		\end{itemize}
		We define the graph $\GSPPS=(\VSPPS, \ESPPS)$, where $\VSPPS=V^*_S\cup\VSPP\cup V^*_T$ and $\ESPPS=E^*_S\cup\EB\cup E^*_T.$
		
		
		The major advantage of this approach is that, once sets $N_S^*$ and $N_T^*$ are computed beforehand, the whole graph $\GSPPS$ is fixed because the incident edges can be computed for each point $P_S(P_B^i)$ and $P_T(P_B^i)$, $P_B^i\in V_{\mathcal B}$, separately. 	Figure \ref{fig:dominatingset} shows how the dominating sets $N_S^*$ and $N_T^*$ are computed for an instance of the \SPPN .
		
		\input{figures/Example_ H-SPP-S_ Dominating}
		
		Defining again the variables $d$ and $y$ for the edges in $\ESPPS$, the new formulation for the \SPPN \ can be expressed as the following simplified form:
		\begin{mini*}
			{}{\sum_{(P,Q)\in \ESPPS}\dvar{P}{Q}\yvar{P}{Q}}
			{}{}\label{eq:Example1b}\tag{H-SPPN$^*$}
			\addConstraint{\sum_{\{Q:(P, Q)\in \ESPPS\}}\yvar{P}{Q}-\sum_{\{Q:(Q, P)\in \ESPPS\}}\yvar{Q}{P}}{=\left\{
				\begin{array}{rl} 
					1, & \text{if } P\in\VS, \\
					0, & \text{if } P\in V^*_S\cup\VB\cup V^*_T, \\
					-1, & \text{if }P\in\VT.
				\end{array}
				\right.}
			\addConstraint{\eqref{eq:dC}}{\quad\forall P, Q\in \VSPPS}
			\addConstraint{\eqref{eq:nC}}{\quad\forall P\in \VS\cup\VT.}
		\end{mini*}
		
		
		\begin{prop}
			Let $n=|\cal B|$. The \SPPN \ can be solved in polynomial time $O(n^3)$.
		\end{prop}
		\begin{proof}
			The proof follows using the finite dominating sets $N^*_{S}$ and $N^*_{T}$. First of all, it is clear that the cardinality of these finite dominating  sets is $O(n)$ since there is one point in each set for each vertex of a segment in $\cal B$. Next, we recall that given a set of polygonal obstacles with $O(n)$ vertices, the linear size shortest map from any given point can be computed in 
			$O(n\log n)$ time. Once one has that map finding the shortest path to any other point in the region is done in $O(n)$ time \citep{mitchell_shortest_2017}. Therefore, the \SPPN \ can be solved as follows.
			
			For each point $P_S(P_B^i) \in N^*_S$ we compute its linear size shortest path map and solve the shortest path problem with respect to all the $O(n)$ points in $N^*_T$. Overall, this operation takes $O(n\log n + n^2)$. The same operation has to be repeated for all the $O(n)$ points in $N^*_S$. Hence, the overall complexity for solving the \SPPN \ is $O(n^3)$.
			
		\end{proof}		
		
		
		\subsection{A formulation for the \TSPN}
		
		
		The rationale of the formulation for the \TSPN \ is to consider the variant called Steiner TSP (STSP) (see \citet{letchford_compact_2013}), where some nodes in $\VB$ do not have to be visited, but if necessary they can be visited more than once. 
		
		It is well-known that it is possible to convert any instance of the STSP into an instance of the standard TSP, by computing the shortest paths between every pair of required nodes, when these nodes are fixed. However, in our problem, since the points in the neighbourhoods are not fixed, this simplification cannot be applied to obtain an optimal solution for the \TSPN, although it may produce an approximation to generate lower bounds for the \TSPN.
		
		
		\newcommand{\gvar}[2]{g(#1#2)}
		
		Our approach relies on adjusting a single-commodity flow formulation to ensure connectivity. We can assume wlog that the neighbourhood $N_1$ is required and the drone departs from that depot (assuming to be $N_1$) with $|\mathcal N|-1$ units of commodity. The idea is that the model must deliver one unit of commodity to each of the required neighbourhoods. Then, for each edge $(P, Q)\in \ETSP$, we define the following variables:
		
		
		\begin{itemize}
			\item $\yvar{P}{Q}$, binary variable that is equal to one if the drone goes from $P$ to $Q$.
			\item $\gvar{P}{Q}$, non-negative continuous variable that represents the amount of commodity passing through the edge $(P, Q)$.
		\end{itemize}
		
		Hence, we can adjust the single-commodity flow formulation to the induced graph $\GTSP$ as follows:
		
		\begin{mini*}
			{}{\sum_{(P,Q)\in \ETSP}\dvar{P}{Q}\yvar{P}{Q}}
			{}{}\label{form:H-TSPN}\tag{H-TSPN}
			\addConstraint{\sum_{\{Q:(P_N, Q)\in \EN\}}\yvar{P_N}{Q}}{\geq 1,}{\quad\forall P_N\in \VN}
			\addConstraint{\sum_{\{Q:(P, Q)\in \ETSP\}}\yvar{P}{Q}}{= \sum_{\{Q:(Q, P)\in \ETSP\}}\yvar{Q}{P},}{\quad\forall P\in \VTSP}
			\addConstraint{\sum_{\{Q:(Q, P_N)\in \EN\}}\gvar{Q}{P_N}-\sum_{\{Q:(P_N, Q)\in \EN\}}\gvar{P_N}{Q}}{= 1,}{\quad\forall P_N\in \VN\setminus\{P_{N_1}\}}
			\addConstraint{\sum_{\{Q:(Q, P_B^i)\in \ETSP\}}\gvar{Q}{P_B^i}-\sum_{\{Q:(P_B^i, Q)\in \ETSP\}}\gvar{P_B^i}{Q}}{= 0,}{\quad\forall P_B^i\in \VB}
			\addConstraint{\gvar{P}{Q}}{\leq (|\mathcal N|-1)\yvar{P}{Q},}{\quad\forall (P,Q)\in \ETSP}
			\addConstraint{\eqref{eq:alphaC},\eqref{eq:betaC},\eqref{eq:gammaC},\eqref{eq:deltaC}}{\quad\forall P, Q\in \VTSP,\quad\forall P_B^1, P_B^2\in \VB}
			\addConstraint{\eqref{eq:varepsilonC}, \eqref{eq:yC}, \eqref{eq:dC}}{\quad\forall P, Q\in \VTSP}
			\addConstraint{\eqref{eq:nC}}{\quad\forall P_N\in \VN.}
		\end{mini*}
		
		The first group of constraints impose that the drone departs from each neighbourhood. The second block of constraints are the flow conservation constraints. The third inequalities ensure that one unit of commodity is delivered to each of the required neighbourhood. The fourth ones ensure that the ficticious nodes at the end of the barriers do not consume commodity. Finally, the last inequalities enforce that some commodity goes throughout an edge only if this edge is used in the tour. Inequalities \eqref{eq:alphaC}, \eqref{eq:betaC}, \eqref{eq:gammaC}, \eqref{eq:deltaC}, \eqref{eq:varepsilonC}, \eqref{eq:yC}, \eqref{eq:dC}, \eqref{eq:nC} enforce the variables of the problem to be well-defined.
		
		\input{figures/Example_ H-TSP-S_ Solution}
		
		\begin{prop}
			The \TSPN \ is NP-complete.
		\end{prop}
		
		Note that, once a point is fixed in each neighbourhood, the problem that results in the induced graph $\GTSP$ is the Steiner TSP (STSP), that is NP-complete.
		
		
		\subsubsection{Reformulating the \TSPN}
		The idea of computing a dominating set that represents each of the neighbourhoods in the \SPPN \ can be adopted to reformulate the \TSPN \ in the same way. The dominating sets are stated in the next proposition.
		
		\begin{prop}
			Given a neighbourhood $N\in\mathcal N$, there exists a finite dominating set, $N^*$ of possible candidates to be in $N$. Moreover,
			\begin{align*}
				N^*&=\{P_N(P_{B}^i, P_{B'}^j):P_N(P_{B}^i, P_{B'}^j)=\argmin_{P_N\in N} \|P_B^i - P_N\| + \|P_N - P_{B'}^j\|\text{ and }(P_B^i, P_N), (P_N, P_{B'}^j)\in \EN\}.
			\end{align*}
		\end{prop}
		\begin{proof}
			The way a drone visits a neighbourhood $N$ is
			$$P_{B}^i\longrightarrow P_N\longrightarrow P_{B'}^j,$$
			for some points $P_B^i,\, P_{B'}^j\in \VB$, since, by \ref{A4}, there does not exist a rectilinear path that joins any pair of neighbourhoods. Hence, the points chosen in an optimal solution for \TSPN \ must be those that produce the minimum distances to the points of the previously and next visited barriers in the optimal solution. Therefore, $N^*$ must be composed, at most, by the points in the set
			$$
			\{P_N(P_{B}^i, P_{B'}^j)=\argmin_{P_N\in N} \|P_B^i - P_N\| + \|P_N - P_{B'}^j\| :(P_B^i, P_N), (P_N, P_{B'}^j)\in \EN\},
			$$
			which completes the proof.
		\end{proof}
		Again, we can compute the respective dominating set $N^*$ of a neighbourhood $N\in\mathcal N$ by solving a convex problem for each pair of barrier endpoints: % more complex:
		\begin{align*}
			N^*&=\{P_N(P_{B}^i, P_{B'}^j):P_N(P_{B}^i, P_{B'}^j)=\argmin_{P_N\in N} \|P_B^i - P_N\| + \|P_N - P_{B'}^j\|,\,\varepsilonvar{P_B^i}{P_N} = 1 \text{ and } \varepsilonvar{P_N}{P_{B'}^j} = 1\}.
		\end{align*}
		
		
		The  graph induced by the precomputed dominating sets is described in terms of the following sets
		\begin{itemize}
			\item $V_\mathcal N^*=\{N^*:N\in\mathcal N\}$. Union of the dominating sets associated with each neighbourhood.
			\item $E_N^{\text{int}}=\{(P_N(P_B^i, P_{B'}^j), P_N), (P_N, P_N(P_B^i, P_{B'}^j)) :P_B^i\in\VB,\,P_N\in N\text{ and }P_{B'}^j\in\VB\}.$ Set of edges joining the point selected $P_N\in N$ with each point $P_N(P_B^i, P_{B'}^j)$ in the dominating set $N^*$.
			\item $E_N^{\text{ext}}=\{(P_B^i, P_N(P_B^i, P_{B'}^j)), (P_N(P_B^i, P_{B'}^j), P_{B'}^j):P_B^i\in\VB\text{ and }P_{B'}^j\in\VB\}.$ Set of edges joining the point $P_N(P_B^i, P_{B'}^j)$ with its respective $P_B^i$ and $P_{B'}^j$ in $\VB$.
			\item $E_N^*=E_N^{\text{int}}\cup E_N^{\text{ext}}$. Set of edges associated with the neighbourhood $N$.
			\item $E_\mathcal N^*= \{E_N^*:N\in\mathcal N\}.$ Union of the edges of every neighbourhoods.
		\end{itemize}
		We define the graph $\GTSPS=(\VTSPS, \ETSPS)$, where $\VTSPS=\VTSP\cup V^*_\mathcal N$ and $\ETSPS=E^*_\mathcal N\cup\EB$.
		
		%	Moreover, the points $P_N$ chosen in the solution can be represented by the points in $N^*$ as shown below:
		%	
		%	\begin{align*}\tag{N$^*$-C}\label{eq:nCn}
			%		P_N&=\sum_{P_B^i\in V_{\mathcal B}}\sum_{P_{B'}^j\in V_{\mathcal B}}\mu_N(P_B^iP_{B'}^j)P_N(P_B^iP_{B'}^j),\\
			%		1&=\sum_{P_B^i\in V_{\mathcal B}}\sum_{P_{B'}^j\in V_{\mathcal B}}\mu_N(P_B^iP_{B'}^j),\\
			%		2\mu_N(P_B^iP_{B'}^j)&= \yvar{P_B^i}{P_N} + \yvar{P_N}{P_{B'}^j},
			%	\end{align*}
		%	
		%	where $\mu_N$ are indicator variables that select one of the points in $N^*$ in the solution. Last equality ensures that the path $P_B^i\longrightarrow P_N \longrightarrow P_{B'}^j$ is followed by the drone if and only if $P_N(P_B^i P_{B'}^j)$ is selected.
		
		Again the sets $N^*$ for each $N \in \mathcal N$  can be computed in advance so that the whole graph $\GTSPS$ will be fixed. The new formulation for the \TSPN \ can be represented as the next simplified program:
		
		\begin{mini*}
			{}{\sum_{(P,Q)\in \ETSPS}\dvar{P}{Q}\yvar{P}{Q}}
			{}{}\label{eq:Example2b}\tag{H-TSPN$^*$}
			\addConstraint{\sum_{\{Q:(P_N, Q)\in E^{\text{int}}_N\}}\yvar{P_N}{Q}}{\geq 1,}{\quad\forall P_N\in \VN}
			\addConstraint{\sum_{\{Q:(P, Q)\in \ETSPS\}}\yvar{P}{Q}}{= \sum_{\{Q:(Q, P)\in \ETSPS\}}\yvar{Q}{P},}{\quad\forall P\in \VTSPS}
			\addConstraint{\sum_{\{Q:(Q, P_N)\in E^{\text{int}}_N\}}\gvar{Q}{P_N}-\sum_{\{Q:(P_N, Q)\in E^{\text{int}}_N\}}\gvar{P_N}{Q}}{= 1,}{\quad\forall P_N\in \VN\setminus\{P_{N_1}\}}
			\addConstraint{\sum_{\{Q:(Q, P)\in \ETSPS\}}\gvar{Q}{P}-\sum_{\{Q:(P, Q)\in \ETSPS\}}\gvar{P}{Q}}{= 0,}{\quad\forall P\in \VB\cup\VNS}
			\addConstraint{\gvar{P}{Q}}{\leq (|\mathcal N|-1)\yvar{P}{Q},}{\quad\forall (P,Q)\in \ETSPS}
			\addConstraint{\eqref{eq:dC}}{\quad\forall P, Q\in \VTSPS}
			\addConstraint{\eqref{eq:nC}}{\quad\forall P_N\in \VN.}
		\end{mini*}
		
		The reader may note that the maximum number of dominating points associated with an instance $(\mathcal N, \mathcal B)$ of the \TSPN \ is $\frac{1}{2}|\mathcal N||\mathcal B|(|\mathcal B|-1)$. Therefore, to get all the sets $N^*$ for each $N \in \mathcal  N$, it is required to solve, at most,  $\frac{1}{2}|\mathcal N||\mathcal B|(|\mathcal B|-1)$ convex programs which may be computationally expensive but polynomial.
		
		
		
		\subsection{Relaxing the assumptions of the problem: The \TSPVN}
		
		In this subsection, we analyze the differences between the \TSPN \ and the \TSPVN, where going from one neighbourhood to another one is possible without crossing any barrier. The main difference lies in the description of the edges of the graph induced by the neighbourhoods and the endpoints of the barriers.
		
		By taking the same approach as before, the sets that describe the graph in the new case are $\VN$, $\VB$, $V_{\rm TSPV}$ and $E_{\rm TSPV}$, as described in Subsection \ref{ssec:TSPN}.
		
%		\begin{itemize}
%			\item $\VN=\{P_N:N\in\mathcal N\}$: set of points in the neighbourhoods $\mathcal N$ that must be visited.
%			\item $\VB=\{P^1_B, P^2_B:B=\overline{P^1_B P^2_B}\in \mathcal B\}$: set of endpoints of the barriers in the problem.
%			\item $V = \VN \cup \VB$.
%			\item $E=\{(P, P'):P, P' \in V \text{ and } \overline{PP'}\cap B''=\emptyset,\forall B''\in\B\}$: set of edges formed by the line segments that join every pair of points in $V$ and that do not cross any barrier.
%		\end{itemize} 
		
		The difference between the set of edges in the \TSPVN \ with respect to the graph in \TSPN \ is that, in the former case, the edges that join each pair of neighbourhoods must be considered. This fact leads to include product of continuous variables in the $\alpha$ constraints of the model that represent the determinants that determine if the segment joining the two variable points in the neighbourhoods cross any barrier or not. These products make the problem to become non-convex.
		
		
		%\textcolor{red}{¿Solucion del problema del TSP propuesto en el dibujo? }
		
		%Note that this problem is not convex because the determinants that model the orientation of the points to check if there exist crossings produce product of variables. 
		
		%\begin{equation*}
		%\normalfont{\text{sign}}\left(\determinant{P_S^{}}{P_{B'}^1}{P_{B'}^2}\right) = \normalfont{\text{sign}}\left(\determinant{P_B^i}{P_{B'}^1}{P_{B'}^2}\right)
		%\quad
		%\text{or}
		%\quad
		%\normalfont{\text{sign}}\left(\determinant{P^{}_S}{P_{B'}^1}{P_{B'}^2}\right) = \normalfont{\text{sign}}\left(\determinant{P_B^i}{P_{B'}^1}{P_{B'}^2}\right),
		%\quad\forall B'\in\B.
		%\end{equation*}
		%%$$=\emptyset,\quad\forall B''\in\B,$$
		%\newcommand{\LS}[3]{L(#1|#2#3)}
		%\newcommand{\US}[3]{U(#1|#2#3)}
		%\newcommand{\alpha}[3]{\alpha^{+}(#1|#2#3)}
		%\newcommand{\alphamenos}[3]{\alpha^{-}(#1|#2#3)}
		%\newcommand{\alphacero}[3]{\alpha^{0\,}(#1|#2#3)}
		%\textcolor{red}{Consideramos el caso en el que los puntos estan alineados?}
		%
		%To model the sign of the determinant $\determinant{P_S^{}}{P_{B'}^1}{P_{B'}^2}$, we define the following binary variables:
		%\begin{itemize}
		%\item $\alpha{P_S^{}}{P_{B'}^1}{P_{B'}^2}$, that is one if $\determinant{P_S^{}}{P_{B'}^1}{P_{B'}^2}$ is strictly positive and zero, otherwise.
		%\item $\alphamenos{P_S^{}}{P_{B'}^1}{P_{B'}^2}$, that is one if $\determinant{P_S^{}}{P_{B'}^1}{P_{B'}^2}$ is strictly negative and zero, otherwise.
		%\item $\alphacero{P_S^{}}{P_{B'}^1}{P_{B'}^2}$, that is one if $\determinant{P_S^{}}{P_{B'}^1}{P_{B'}^2}$ is zero and zero, otherwise.
		%\end{itemize}
		%
		%
		%It is possible to represent the sign condition by including the following constraints:
		%%\begin{equation}\tag{sign+}\label{eq:sign}
		%%\LS{P_S^{}}{P_{B'}^1}{P_{B'}^2}\left(1-\alpha{P_S^{}}{P_{B'}^1}{P_{B'}^2}\right)\leq \determinant{P_S^{}}{P_{B'}^1}{P_{B'}^2}\leq \US{P_S^{}}{P_{B'}^1}{P_{B'}^2}\alpha{P_S^{}}{P_{B'}^1}{P_{B'}^2},
		%%\end{equation}
		%\begin{align*}\tag{sign}\label{eq:sign}
		%\determinant{P_S^{}}{P_{B'}^1}{P_{B'}^2}&\leq \US{P_S^{}}{P_{B'}^1}{P_{B'}^2}\:\alpha{P_S^{}}{P_{B'}^1}{P_{B'}^2},\\
		%\determinant{P_S^{}}{P_{B'}^1}{P_{B'}^2}&\geq \LS{P_S^{}}{P_{B'}^1}{P_{B'}^2}\:\alphamenos{P_S^{}}{P_{B'}^1}{P_{B'}^2},\\
		%\alpha{P_S^{}}{P_{B'}^1}{P_{B'}^2}+\alphamenos{P_S^{}}{P_{B'}^1}{P_{B'}^2}+\alphacero{P_S^{}}{P_{B'}^1}{P_{B'}^2}& = 1,
		%\end{align*}
		%where $\LS{P_S^{}}{P_{B'}^1}{P_{B'}^2}$ and $\US{P_S^{}}{P_{B'}^1}{P_{B'}^2}$ are a lower and a upper bound for the determinant, respectively. If the determinant is strictly positive, then $\alpha{P_S^{}}{P_{B'}^1}{P_{B'}^2}$ must be one to make the first inequality feasible, the second inequality is always fulfilled and the third one sets the other indicator variables to zero. The analagous case happens if the determinant is strictly negative. However, if the determinant is equal to zero, both inequalities are fulfilled and it is necessary to include the term $\epsilon (1-\alphacero{P_S^{}}{P_{B'}^1}{P_{B'}^2})$ in the objective function, where $\epsilon>0$ is a small value, to ensure that $\alphacero{P_S^{}}{P_{B'}^1}{P_{B'}^2}$ is equal to one when the determinant is zero.
		%
		%\newcommand{\betamas}[4]{\beta^{+}(#1#2|#3#4)}
		%\newcommand{\betamenos}[4]{\beta^{-}(#1#2|#3#4)}
		%\newcommand{\betacero}[4]{\beta^{0\,}(#1#2|#3#4)}
		%
		%At this point, it is required to introduce the binary variables that checks if both determinants are positive, negative or null:
		%
		%\begin{itemize}
		%\item $\betamas{P_S^{}}{P_B^i}{P_{B'}^1}{P_{B'}^2}$, that is one if $\determinant{P_S^{}}{P_{B'}^1}{P_{B'}^2}$ and $\determinant{P_B^i}{P_{B'}^1}{P_{B'}^2}$ are both positive.
		%\item $\betamenos{P_S^{}}{P_B^i}{P_{B'}^1}{P_{B'}^2}$, that is one if $\determinant{P_S^{}}{P_{B'}^1}{P_{B'}^2}$ and $\determinant{P_B^i}{P_{B'}^1}{P_{B'}^2}$ are both negative.
		%\item $\betacero{P_S^{}}{P_B^i}{P_{B'}^1}{P_{B'}^2}$, that is one if $\determinant{P_S^{}}{P_{B'}^1}{P_{B'}^2}$ and $\determinant{P_B^i}{P_{B'}^1}{P_{B'}^2}$ are both zero.
		%\end{itemize}
		%
		%Hence, the $\beta$ variables can be represented by the product of the $\alpha$ variables:
		%\begin{align*}
		%\betamas{P_S^{}}{P_B^i}{P_{B'}^1}{P_{B'}^2}&=\alpha{P_{B'}^1}{P^{}_S}{P^i_B}\:\alpha{P_{B'}^2}{P^{}_S}{P^i_B},\\
		%\betamenos{P_S^{}}{P_B^i}{P_{B'}^1}{P_{B'}^2}&=\alphamenos{P_{B'}^1}{P^{}_S}{P^i_B}\:\alphamenos{P_{B'}^2}{P^{}_S}{P^i_B},\\
		%\betacero{P_S^{}}{P_B^i}{P_{B'}^1}{P_{B'}^2}&=\alphacero{P_{B'}^1}{P^{}_S}{P^i_B}\:\alphacero{P_{B'}^2}{P^{}_S}{P^i_B}.
		%\end{align*}
		%
		%These products can be linearized by means of these constraints:
		%$$
		%\left\{\begin{array}{rcl}
			%\betamas{P_S^{}}{P_B^i}{P_{B'}^1}{P_{B'}^2} & \leq & \alpha{P_{B'}^1}{P^{}_S}{P^i_B},\\\\
			%\betamas{P_S^{}}{P_B^i}{P_{B'}^1}{P_{B'}^2} & \leq & \alpha{P_{B'}^2}{P^{}_S}{P^i_B},\\\\
			%\betamas{P_S^{}}{P_B^i}{P_{B'}^1}{P_{B'}^2} & \geq & \alpha{P_{B'}^1}{P^{}_S}{P^i_B} + \alpha{P_{B'}^2}{P^{}_S}{P^i_B} - 1.\end{array}\right.
		%$$
		%
		% $\alpha{P_S^{}}{P_{B'}^1}{P_{B'}^2}$ that attains minus one if the sign of the determinant is negative, zero, if the determinant is zero, and one, if the determinant is positive. The following constraints set the sign condition:
		%\begin{equation}\tag{sign}\label{eq:sign}
		%\LS{P_S^{}}{P_{B'}^1}{P_{B'}^2}\:\alpha{P_S^{}}{P_{B'}^1}{P_{B'}^2}\leq \determinant{P_S^{}}{P_{B'}^1}{P_{B'}^2}\leq \US{P_S^{}}{P_{B'}^1}{P_{B'}^2})\left(1-\alpha{P_S^{}}{P_{B'}^1}{P_{B'}^2}\right),
		%\end{equation}
		% If the determinant is negative, then the right side of the equation must be zero, and $\alpha{P_S^{}}{P_{B'}^1}{P_{B'}^2}$ is one. Analogously, if the determinant is non-negative, then the left side must be zero and $\alpha{P_S^{}}{P_{B'}^1}{P_{B'}^2}$ is also zero.
		%
		%%In the left picture, the number of incident edges $|E_S|$ on $N_S$ is 4 whereas the right picture is 6.
		
		\section{Strengthening the formulations}\label{section:strengthening}
		
		\subsection{Preprocessing}\label{subsection:preprocessing}
		In this subsection, a preprocessing result that allows one to fix some variables is proposed. It is based on analyzing the relative position between the neighbourhoods and the barriers.
		Specifically, we present a sufficient condition that ensures that there are some barriers whose endpoints can not be incident in the edges of $\EN$ so that it is not necessary to include them in $\EN$. 
		
		Let us denote
		
		\begin{align*}
			\text{cone}(P|QR)&:=\{\mu_1 \overrightarrow{PQ}+\mu_2\overrightarrow{PR}:\mu_1,\mu_2\geq 0\},\\
			\text{cone}(P|QR)^-&:=\{\mu_1 \overrightarrow{PQ}+\mu_2\overrightarrow{PR}:\mu_1,\mu_2\geq 0,\:\mu_1+\mu_2\leq 1\},\\
			\text{cone}(P|QR)^+&:=\{\mu_1 \overrightarrow{PQ}+\mu_2\overrightarrow{PR}:\mu_1,\mu_2\geq 0,\:\mu_1+\mu_2\geq 1\}.
		\end{align*}
		Note that $\text{cone}(P|QR)$ is the union of $\text{cone}(P|QR)^-$ and $\text{cone}(P|QR)^+$. It is also important to remark that $\text{cone}(P|QR)^+$ represents the subset of points $P'$ in the plane whose segments $\segment{P}{P'}$ cross the barrier $\overline{QR}$ (see Figure \ref{fig:cones}), i.e.
		$$\text{cone}(P|QR)^+=\{P':\overline{PP'}\cap\overline{QR}\neq\emptyset\}.$$
		
		\begin{figure}[h!]
			\centering
			\includegraphics[width=0.75\linewidth]{figures/cones}
			\caption{Representation of the cone generated by the point $P$ and the line segment $\segment{Q}{R}$.}
			\label{fig:cones}
		\end{figure}
		Let $B = \overline{P^1_BP^2_B}\in\mathcal B$ a barrier. In the following proposition, we give a sufficient condition to not include the edge $(P^{}_N, P^i_B)$ in $\EN$.
		
		\begin{prop}
			
			Let $B'=\overline{P^1_{B'}P^2_{B'}}\in\mathcal B$ and $\normalfont{\text{cone}}(P^i_B|P^1_{B'}P^2_{B'})^+$ the conical hull generated by these points. If
			$$N\subset\bigcup_{B'\in\mathcal B}\normalfont{\text{cone}}(P^i_B| P^1_{B'}P^2_{B'})^+,$$
			then $(P^{}_N, P^i_B)\not\in \EN$.
			
			%Let $B'=\overline{P^1_{B'}P^2_{B'}}\in\mathcal B$ and $Q(B')$ the intersection point of the straight lines that join points of $N$ and $B'$ that lies outside of the convex hull generated by thse line segments. Let $\normalfont{\text{cone}}(\{\overrightarrow{Q(B')P^1_N},\overrightarrow{Q(B')P^2_N}\})$ the conical hull of these vectors. If
			%$$B\subset\bigcup_{B'\in\mathcal B}\normalfont{\text{cone}}(\{\overrightarrow{Q(B')P^1_N},\overrightarrow{Q(B')P^2_N}\}),$$
			%then $(P^{}_N, P^i_{B})\not\in \EN$, $i=1,2$.
		\end{prop}
		\begin{proof}
			If $P_N\in N$, then there exists a $B'\in\mathcal B$ such that 
			$P_N\in \normalfont{\text{cone}}(P^i_B|P^1_{B'}P^2_{B'})^+$. Therefore, $\overline{P^i_B P^{}_N}\cap B'\neq\emptyset$ and $(P^{}_N, P^i_B)\not\in \EN$.
		\end{proof}
		
		One can easily check computationally the condition of the previous proposition by using the following procedure. First, we deal with the case  when the neighbourhoods are segments. Let $N = \overline{P^1_N P^2_N}$ be a line segment and $r_N$ the straight line that contains the line segment $N$ that is represented as:
		
		$$r_N:P_N^1+\lambda\overrightarrow{P_N^1P_N^2},\qquad\lambda\in\mathbb R.$$
		
		
		\begin{algorithm}[H]
			\caption{Checking computationally whether $(P^{}_N, P^i_B)\not\in \EN$ when $N$ is a segment.}
			\label{alg:Algorithm1}
			\SetKwInOut{Input}{Initialization}\SetKwInOut{Output}{output}
			
			\Input{Let $P^i_B$ be the point of the edge $(P^{}_N, P^i_B)$ to check whether $(P^{}_N, P^i_B)\not\in \EN$.\\
				Set $points = \{P^1_N, P^2_N\}$, $lambdas=\{0, 1\}$.}
			% Set $LB=0$, $UB=+\infty$, $\bar z=z^0$.
			\For{$B''\in\mathcal B$}{
				\For{$j\in\{1, 2\}$}{
					Compute the straight line 
					$$r(P^i_B, P^j_{B''}) = P^i_B + \mu^j_{B''}\overrightarrow{P^i_BP^j_{B''}},$$ 
					that contains the points $P^i_B$ and $P^j_{B''}$. \\
					
					Intersect $r(P^i_B, P^j_{B''})$ and $r_N$ in the point $Q^j_{B''}$ and compute $			\overline{\mu}^j_{B''}$ such that 
					$$Q^j_{B''}=P_B^i + \overline{\mu}^j_{B''} \overrightarrow{P^i_BP^j_{B''}}.$$\\
					
					\If{$|\overline{\mu}^j_{B''}|\geq 1$}{
						Compute $\lambda^j_{B''}$ such that 
						$$Q^j_{B''}=P^1_N+\lambda^j_{B''}\overrightarrow{P^1_NP^2_N}.$$\\
						\If{$\overline{\mu}^j_{B''}\geq 1$}{
							Include $\lambda^j_{B''}$ in $lambdas$.}
						\Else{
							\If{$\lambda^j_{B''}\geq 0$}{
								Set $\lambda^j_{B''}=M<<0$ and include it in $lambdas$.}
							\Else{
								Set $\lambda^j_{B''}=M>>0$ and include it in $lambdas$.}
						}	
					}
				}
			}
			Order  the set $lambdas$ in non-decreasing order.\\
			If it is satisfied that
			\begin{align*}
				\min\{\lambda_{B'}^1, \lambda_{B'}^2\}\leq 0\leq\max\{\lambda_{B'}^1, \lambda_{B'}^2\},&\quad\text{ for some } B'\in\mathcal B,\\
				\min\{\lambda_{B'}^1, \lambda_{B'}^2\}\leq 1\leq\max\{\lambda_{B'}^1, \lambda_{B'}^2\},&\quad\text{ for some } B'\in\mathcal B,\\
				\min\{\lambda_{B'}^1, \lambda_{B'}^2\}\leq\lambda_{B''}^j\leq\max\{\lambda_{B'}^1, \lambda_{B'}^2\},&\quad\text{ for some } B'\in\mathcal B\setminus\{B''\},\quad\forall \lambda_{B''}^j\in lambdas\setminus\{M\},
			\end{align*}
			or
			$$
			\min\{\lambda_{B'}^1, \lambda_{B'}^2\}\leq 0, 1\leq\max\{\lambda_{B'}^1, \lambda_{B'}^2\},\quad\text{ for some } B'\in\mathcal B,
			$$
			then $(P^{}_N, P^i_B)\not\in \EN$.
			
		\end{algorithm}
		
		In Figure \ref{fig:algorithm1} an example of the Algorithm \ref{alg:Algorithm1} is described to check if there exists a rectilinear path joining the solid point $P^i_B$ in the red barrier defined by the extreme points $P_B^i$ and $P_B^j$ with the segment $\segment{P^1_N}{P^2_N}$. First, the dashed straight lines $r(P^i_B, P^j_{B''})$  generated by $P^i_B$ and each point of the barrier are computed. Second, the straight line $r_N$ is determined by $P_N^1$ and $P_N^2$. Then, each one of the straight lines $r(P^i_B, P^j_{B''})$ is intersected with $r_N$ obtaining the points $Q_1^1,\,Q_2^1,\,Q_1^2$ and $Q_2^2$. Each one of these points has associated two parameter values $\mu$ and $\lambda$ with respect to the straight lines $r(P^i_B, P^j_{B''})$ and $r_N$, respectively. Finally, the points are ordered in non-decreasing sequence with respect to the $\lambda$ values. Since 
			$$
			M=\lambda_1^1 \leq 0, 1\leq\lambda_1^2=2,
			$$
			the segment $\segment{P_N^1}{P_N^2}$ is fully included in $\text{cone}(P_B^i|P_1^1P_1^2)^+$ and therefore, $(P^i_B, P_N)$ is not included in $\EN$.
		
		\input{figures/Preprocessing - First case}
		
		Note that this algorithm also allows us to decide whether the drone can access to a point of a barrier from any point of the neighbourhood $N$. It is enough to check in (15) that 
		$$0\not\in \left[\min\{\lambda_{B'}^1, \lambda_{B'}^2\},\max\{\lambda_{B'}^1, \lambda_{B'}^2\}\right]\quad\text{and}\quad 1\not\in \left[\min\{\lambda_{B'}^1, \lambda_{B'}^2\},\max\{\lambda_{B'}^1, \lambda_{B'}^2\}\right],\quad\forall B'\in\mathcal B.$$
		
		For the case of $N$ being an ellipse, the same rationale can be followed. The idea is to generate the largest line segment contained in the ellipse and to repeat the procedure in Algorithm \ref{alg:Algorithm1}. Let $F_1$ and $F_2$ be the focal points of $N$.
		
		\begin{algorithm}[H]
			\caption{Checking computationally whether $(P^{}_N, P^i_B)\not\in \EN$ when $N$ is an ellipse.}
			\label{alg:Algorithm2}
			\SetKwInOut{Input}{Initialization}\SetKwInOut{Output}{output}
			
			\Input{Let $P^i_B$ be the point whose edge $(P^i_B, P^{}_N)$ is going to check whether $(P^{}_N, P^i_B)\not\in \EN$.\\
				Set $points = \{\}$, $lambdas=\{\}$.}
			% Set $LB=0$, $UB=+\infty$, $\bar z=z^0$.}
		Compute the straight line $r(F^1, F^2)$.\\
		Intersect $r(F^1, F^2)$ and the boundary of $N$, $\partial N$, in the points $P_N^1$ and $P_N^2$. \\
		Include $P_N^1$ and $P_N^2$ in $points$. \\
		Apply Algorithm \ref{alg:Algorithm1}.
	\end{algorithm}
	
	\subsection{Valid inequalities}
	This subsection is devoted to showing some results that adjust the big-M constants that appear in the previous formulation, specifically, in constraints \eqref{eq:alphaC}, where modeling of the sign requires one to compute the lower and upper bounds $L$ and $U$, respectively. We are going to determine these bounds explicitly for the cases where the neighbourhoods are ellipses and segments.
	
	Let $\overline{P^1_{B'}P^2_{B'}}=B'\in\B$ be a barrier, and $P_N\in N$. Let $\determinant{P_N}{P_{B'}^1}{P_{B'}^2}$ also be the determinant whose value must be bounded. Clearly, the solution of the following problem gives a lower bound of the determinant:
	\begin{equation*}\label{eq:L-Problem}\tag{L-Problem}
		\overline{L}=\min_{P_N=(x,y)\in N}F(x,y):=\determinant{P^{}_N}{P_{B'}^1}{P_{B'}^2}=\left|
		\begin{array}{cc}
			P^{1}_{B'_x}-x & P^{2}_{B'_x}-x \\
			P^{1}_{B'_y}-y & P^{2}_{B'_y}-y
		\end{array}
		\right|.
	\end{equation*}
	
	\subsubsection{Lower and upper bounds when the neighbourhoods are line segments}
	In this case, the segment whose endpoints are $P^1_{N}$ and $P^2_{N}$ can be expressed as the following convex set:
	$$N=\{(x,y)\in\mathbb R^2:(x,y)=\mu P^1_{N}+(1-\mu)P^2_{N}, \; 0\leq\mu\leq1\}.$$
	Since we optimise a linear function in a compact set, we can conclude that the objective function in \eqref{eq:L-Problem} achieves its minimum and its maximum at the extreme points of $N$, that is, in $P^1_{N}$ and $P^2_{N}$. 
	
	\subsubsection{Lower and upper bounds when the neighbourhoods are ellipses}\label{subsection:bounds}
	The next case considered is that when $N$ is an ellipse, that is, $N$ is represented by the following inequality:
	$$N=\{(x,y)\in\mathbb R^2:ax^2+by^2+cxy+dx+ey+f\leq 0\},$$
	where $a, b, c, d, e, f$ are coefficients of the ellipse.
	In an extended form, we need to find:
	\begin{mini*}
		{}{F(x, y)=\left|
			\begin{array}{cc}
				P^{1}_{B'_x}-x & P^{2}_{B'_x}-x \\
				P^{1}_{B'_y}-y & P^{2}_{B'_y}-y
			\end{array}
			\right|=xP^{1}_{B'_y}-xP^{2}_{B'_y}+yP^{2}_{B'_x}-yP^{1}_{B'_x}+P^{1}_{B'_x}P^{2}_{B'_y}-P^{1}_{B'_y}P^{2}_{B'_x},}
		{\label{eq:L-Ellipse}}{\tag{L-Ellipse}}
		\addConstraint{ax^2+by^2+cxy+dx+ey+f\leq 0.}
	\end{mini*}
	Since we minimise a linear function in a convex set, we can conclude that the extreme points are located in the frontier, so we can use the Lagrangian function to compute these points.
	$$F(x,y;\lambda)=xP^{1}_{B'_y}-xP^{2}_{B'_y}+yP^{2}_{B'_x}-yP^{1}_{B'_x}+P^{1}_{B'_x}P^{2}_{B'_y}-P^{1}_{B'_y}P^{2}_{B'_x}+\lambda(ax^2+by^2+cxy+dx+ey+f).$$
	
	$$\nabla F(x,y;\lambda)=0\Longleftrightarrow
	\left\{\begin{array}{rcll}
		\frac{\partial F}{\partial x} & = & P^{1}_{B'_y}-P^{2}_{B'_y}+2ax\lambda+cy\lambda+d\lambda& =0,\\
		\frac{\partial F}{\partial y} & = & P^{2}_{B'_x}-P^{1}_{B'_x}+2by\lambda+cx\lambda+e\lambda& =0,\\
		\frac{\partial F}{\partial \lambda} & = & ax^2+by^2+cxy+dx+ey+f& =0.\\
	\end{array}\right.$$
	From the first two equations, we obtain:
	
	$$\lambda = \frac{P^{2}_{B'_y}-P^{1}_{B'_y}}{2ax+cy+d}=\frac{P^{1}_{B'_x}-P^{2}_{B'_x}}{2by+cx+e}.$$
	
	From this equality, we obtain the following general equation of the straight line:
	\begin{align*}
		(P^{2}_{B'_y}-P^{1}_{B'_y})(2by+cx+e)-(P^{1}_{B'_x}-P^{2}_{B'_x})(2ax+cy+d)&=0,\\
		\left[c(P^2_{B'_y}-P^1_{B'_y})-2a(P^1_{B'_x}-P^2_{B'_x})\right]x+\left[2b(P^2_{B'_y}-P^1_{B'_y})-c(P^1_{B'_x}-P^2_{B'_x})\right]y+\left[e(P^2_{B'_y}-P^1_{B'_y})-d(P^1_{B'_x}-P^2_{B'_x})\right]&=0,\\
		\left[(2a, c)\cdot\overrightarrow{P^1_{B'}P^2_{B'}}\right]x+\left[(c, 2b)\cdot\overrightarrow{P^1_{B'}P^2_{B'}}\right]y+\left[(d, e)\cdot\overrightarrow{P^1_{B'}P^2_{B'}}\right]&=0,
		%	y\left[2b(P^{2}_{B'_y}-P^{1}_{B'_y})-c(P^{1}_{B'_x}-P^{2}_{B'_x})\right]&=\left[2a(P^{1}_{B'_x}-P^{2}_{B'_x})-c(P^{2}_{B'_y}-P^{1}_{B'_y})\right]x+\left[d(P^{1}_{B'_x}-P^{2}_{B'_x})-e(P^{2}_{B'_y}-P^{1}_{B'_y})\right],\\
		%	y&=\left[\frac{2a(P^{1}_{B'_x}-P^{2}_{B'_x})-c(P^{2}_{B'_y}-P^{1}_{B'_y})}{2b(P^{2}_{B'_y}-P^{1}_{B'_y})-c(P^{1}_{B'_x}-P^{2}_{B'_x})}\right]x+\left[\frac{d(P^{1}_{B'_x}-P^{2}_{B'_x})-e(P^{2}_{B'_y}-P^{1}_{B'_y})}{2b(P^{2}_{B'_y}-P^{1}_{B'_y})-c(P^{1}_{B'_x}-P^{2}_{B'_x})}\right],\\
		%	y&=mx+n.
	\end{align*}
	where $\cdot$ denotes the scalar product of two vectors. 
	Solving the quadratic system:
	$$
	\left\{\begin{array}{rl}
		\left[(2a, c)\cdot\overrightarrow{P^1_{B'}P^2_{B'}}\right]x+\left[(c, 2b)\cdot\overrightarrow{P^1_{B'}P^2_{B'}}\right]y+\left[(d, e)\cdot\overrightarrow{P^1_{B'}P^2_{B'}}\right]&=0,\\
		ax^2+by^2+cxy+dx+ey+f& =0,\\
	\end{array}\right.$$
	they arise two solutions $x^{\pm}$ and $y^{\pm}$ that are evaluated in the objective function to obtain the lowest and highest value, respectively, according to $\LS{P_N^{}}{P_{B'}^1}{P_{B'}^2}$ and $\US{P_N^{}}{P_{B'}^1}{P_{B'}^2}$, respectively.
	The reader may note that the same approach can be adopted to obtain the bounds for the rest of the determinants that appear in \eqref{eq:alphaC}.
	
	
	\subsubsection{Variable Fixing}
	In this subsection, the geometry of the problem is exploited to fix the variables. In particular, when a neighbourhood $N$ is in the half-space generated by a barrier $B$, the sign of the determinant $\determinant{P_N}{P_B^1}{P_B^2}$ does not change for any point $P_N\in N$. Therefore, a relevant number of variables $\alpha$ (hence $\beta$, $\gamma$, $\delta$ and $\varepsilon$) that model the sign of this determinant can be fixed `a priori'. It is sufficient to check whether both bounds $\LS{P_N^{}}{P_{B'}^1}{P_{B'}^2}$ and $\US{P_N^{}}{P_{B'}^1}{P_{B'}^2}$ computed in Subsection \ref{subsection:bounds} have the same sign or not. Figure \ref{fig:fixing_variables} shows an example where variables $\alpha$ can be fixed. Each of the blue neighbourhoods is completely contained in the half-spaces generated by the barrier, and $\alpha$ is fixed. However, the variable $\alpha$ corresponding to the orange neighbourhood depends on the half-space in which $P_N$ is located.
	
	\input{figures/Fixing_Variables}
	
	\section{Computational experiments}\label{section:experiments}
	This section is devoted to studying the performance of the \eqref{form:H-TSPN} formulation proposed in Section \ref{section:formulations}. In the first subsection, the procedure for generating the considered random instances is described. The second subsection details the experiments that have been conducted. The third subsection reports the results obtained in these experiments.
	
	\subsection{Data generation}
	%To generate the instances of our experiments, it is necessary that these instances verify the assumptions \ref{A1}-\ref{A4} stated in the Section \ref{section:description}. 
	
	To generate the instances of our experiments, we assume  assumptions \ref{A1}-\ref{A4} stated in Section \ref{section:description}. The following proposition gives an upper bound for the number of balls that can be generated given an instance with $n=|\mathcal B|$ barriers:
	
	%		\JP{	
		%		\begin{prop}
			%			Under the hypothesis that balls are \CV{not} visible among them, the maximum number of balls that can be considered in \TSPN \ is $O(n^2)$.
			%		\end{prop}
		%		\begin{proof}
			%			The proof is based on the properties of the visibility graph $VG(\cal B)$ of the configuration of barriers in $\cal B$:  It is clear that the maximum number of balls coincides with the number of faces, $f_{VG(\cal B)}$, of $VG(\cal B)$.  Recall that the number of vertices in $\cal B$ is $n$. Next, by the Euler formula, the number of faces $f_{VG(\cal B)}$ is $2+E_{VG(\cal B)}-n$. Since $E_{VG(\cal B)}=O(n^2)$, it follows that $f_{VG(\cal B)}=O(n^2)$.
			%		\end{proof}
		%	}
	
	
	\begin{prop}
		Under assumptions \ref{A1}-\ref{A4}, the maximum number of balls that can be considered in \TSPN \ is $O(n^2)$.
	\end{prop}
	\begin{proof}
		The proof is based on the properties of the visibility graph $VG(\cal B)$ of the configuration of barriers in $\cal B$ \citep{mitchell_shortest_2017}:  It is clear that the maximum number of balls coincides with the number of faces, $f_{VG(\cal B)}$, of $VG(\cal B)$.  Recall that the number of vertices in $\cal B$ is $n$. Next, by the Euler formula the number of faces $f_{VG(\cal B)}$ is $2+E_{VG(\cal B)}-n$. Since $E_{VG(\cal B)}=O(n^2)$, it follows that $f_{VG(\cal B)}=O(n^2)$.
	\end{proof}
	
	
	The idea is to generate line segments located in general position without crossings and neighbourhoods that do not intersect with these line segments. The following procedure describes how to construct instances where the neighbourhoods are balls.
	
	\begin{algorithm}[H]
		\caption{Generation of instances when the neighbourhoods are balls}
		\label{alg:Algorithm3}
		\SetKwInOut{Input}{Initialization}\SetKwInOut{Output}{output}
		
		\Input{Let $|\mathcal N|$ be the number of neighbourhoods to generate. Let $r_{\text{init}}=10$ be half of the initial length of the barriers.
			Set $\mathcal N = \{\}$; $points=\{\}$; $\mathcal B=\{\overline{(0, 0)(100, 0)}, \overline{(100, 0)(100, 100)}, \overline{(100, 100)(0, 100)}, \overline{(0, 100)(0, 0)}\}$.}
		% Set $LB=0$, $UB=+\infty$, $\bar z=z^0$.
		Generate $|\mathcal N|$ points uniformly distributed in the square $[0, 100]^2$ and include them in $points$. \\
		%\While{There does not exist a barrier that separates each pair of points}{
			\For{$P, P'\in points$}{
				\If{$\overline{PP'}\cap B=\emptyset,\;\forall B\in\mathcal B$}{
					Compute $\overrightarrow{d}=\overrightarrow{PP'}$.\\
					Compute $M = P + \frac 1 2 \overrightarrow{d}$.\\
					Compute the unitary vector $\overrightarrow{n_u}$ perpendicular to $\overrightarrow{d}$.\\
					Set $r = r_{\text{init}}$. \\
					Generate the barrier $B(r)=\overline{P_B^{+} P_B^{-}}$ where
					$P_B^{\pm}=M \pm r\overrightarrow{n_u}.$\\
					\While{$B(r)\cap B'\neq\emptyset$ for some $B'\in\mathcal B$}{
						Set $r := r / 2$. \\
						Generate the barrier $B(r)$.
					}
					
					Include $B(r)$ in $\mathcal B$.
					
					
				}
			}
			\For{$P\in points$}{
				Set $r_{\text{min}}=\min_{\{P_B\in B: B \in\mathcal B\}} d(P, P_B).$\\
				Generate a random $radii$ uniformly distributed in the interval $\left[\frac 1 2 r_{\text{min}}, r_{\text{min}}\right]$.\\
				Set the ball $N$ whose centre is $P$ and radii is $radii$. \\
				Include $N$ in $\mathcal N$.
			}
			%}
	\end{algorithm}
	The line segments instances are generated by randomly selecting two diametrically opposite points in the boundary of the balls instances obtained with Algorithm \ref{alg:Algorithm3}.
	%	To generate the instances when the neighbourhoods are segments, we can take the balls built in the previous procedure and draw a random angle that determines which point and its diametrically opposite point are selected as the endpoints of the line segment.
	
	% \textcolor{red}{Quizás evitar el uso $n$ sea adecuado para evitar confusiones}
	\subsection{Configuration of the experiments}
	Since no benchmark instances are available for this problem in the literature, we have generated ten instances with a number of neighbourhoods $|\mathcal N|\in\{5, 10, 20, 30, 50, 80, 100\}$ of two typologies: balls and line segments. We have distinguished the cases with and without preprocessing the variables of the formulations, as explained in Subsection \ref{subsection:preprocessing}, and we have reported the average results. 
	
	The formulations were coded in Python 3.9.2 (\citet{g_van_rossum_guido_python_1995}) and solved in Gurobi 9.1.2 (\citet{gurobi_optimization_llc_gurobi_2022}) on an AMD® Epyc 7402p 8-core processor. A time limit of 1 hour was set in the experiments.
	
	\subsection{Results of the experiments}
	We report the results of our experiments in Table \ref{table:results}. The layout is organised in 5 blocks of columns. The first one describes the number of neighbourhoods $|\mathcal{N}|$, the second (neighbourhood) describes the typology of neighbourhood used in the experiment (Balls or Segments), the third one (preprocessing)  informs whether the preprocessing is being applied or not (True or False). The next three blocks include information  on the number of barriers ($|\mathcal{B}|$), the  gap at termination (Gap) defined as $Gap=(upper\, bound - lower\, bound)/lower\, bound$, and the computing time (Runtime). The block $|\mathcal{B}|$ indicates the minimum and maximum number of barriers considered in each of the instances for each fixed number $|\mathcal{N}|$ of neighbours. The block Gap contains three columns reporting the average (mean), minimum (min), and maximum (max) gaps of the ten instances considered for each combination of parameters. Analogously, the block Runtime also includes three columns reporting the average (mean), minimum (min) and maximum (max) computing time of the ten instances considered for each combination of parameters.
	By rows, Table \ref{table:results} reports results for instances with a number of neigbourhoods $|\mathcal{N}|$ in the set $\{5,10,20,30,50,80,100\}$. For each value of $|\mathcal{N}|$  we report results for two typologies of neigbourhoods, namely Balls and Segments, without preprocessing (False) and with preprocessing (True).
	
	Analysing the results in Table \ref{table:results}, first of all we observe that solving the problem considering balls as neighbourhoods is harder than considering segments. Next, we also observe that our formulation solves to optimality all instances for segments up to $|\mathcal{N}|=30$ with preprocessing. In addition, both typologies of instances, up to $|\mathcal{N}|=50$, are almost solved by obtaining a small average gap. %and also almost all for balls leaving always a gap less than or equal to  1\%. 
	We also observe that the use of preprocessing helps in solving the instances since in those cases where they are not solved to optimality the gap and the runtime are reduced. The situation for $|\mathcal{N}|\in \{80,100\}$ is slightly different. For $|\mathcal{N}|=80$ and balls as neighbourhoods, the preprocessing time takes more than an hour so that no results can be reported whereas without preprocessing the formulations are always able to find solutions with average gaps of ($\le 0.6$) within one hour of computing time.  % For segments we see that the use of preprocessing helps and the gaps are smaller within the time limit. 
	Finally, for the case of $|\mathcal{N}|=100$ balls as neighbourhoods, none of the configurations with or without preprocessing is capable to find a feasible solution in 3600 seconds. The behaviour is different for segments. In this case, both configurations provide feasible solutions. In the last case, the use of preprocessing is rather heavy and consumes most of the 3600 seconds of computing time. This can be observed in the final gaps. The case without preprocessing reports better gaps, as leaving more time to the solver to find better solutions, and the average gap is $0.53$ rather than $0.81$ for the case with preprocessing.
	
	%% Table generated by Excel2LaTeX from sheet 'Hoja1'
	%\begin{table}[htbp]
	%	\centering
	%	\caption{Add caption}
	%	\resizebox{\textwidth}{!}{
		%	\begin{tabular}{|c|c|c||cc|ccc|ccc|}
			%		\hline
			%		$\bm{|\mathcal N|}$ & \textbf{Typology} & \textbf{preprocessing} & \multicolumn{2}{c|}{$\bm{|\mathcal B|}$} & \multicolumn{3}{c|}{\textbf{Gap}} & \multicolumn{3}{c|}{\textbf{Runtime}} \bigstrut[t]\\
			%		&       &       & \textbf{min} & \textbf{max} & \textbf{mean} & \textbf{min} & \textbf{max} & \textbf{mean} & \textbf{min} & \textbf{max} \bigstrut[b]\\
			%		\hline
			%		\hline
			%		\multirow{4}[4]{*}{5} & \multirow{2}[2]{*}{Ball} & False & 8     & 11    & 0     & 0     & 0     & 2.46  & 1.2   & 8.05 \bigstrut[t]\\
			%		&       & True  & 8     & 11    & 0     & 0     & 0     & 1.63  & 0.81  & 2.49 \bigstrut[b]\\
			%		\cline{2-11}          & \multirow{2}[2]{*}{Segment} & False & 8     & 11    & 0     & 0     & 0     & 1.35  & 0.82  & 2.52 \bigstrut[t]\\
			%		&       & True  & 8     & 11    & 0     & 0     & 0     & 1.09  & 0.79  & 1.41 \bigstrut[b]\\
			%		\hline
			%		\hline
			%		\multirow{4}[4]{*}{10} & \multirow{2}[2]{*}{Ball} & False & 15    & 21    & 0     & 0     & 0     & 13.43 & 7.85  & 27.68 \bigstrut[t]\\
			%		&       & True  & 15    & 21    & 0     & 0     & 0     & 6.22  & 3.61  & 11.85 \bigstrut[b]\\
			%		\cline{2-11}          & \multirow{2}[2]{*}{Segment} & False & 15    & 21    & 0     & 0     & 0     & 7.41  & 5.04  & 9.23 \bigstrut[t]\\
			%		&       & True  & 15    & 21    & 0     & 0     & 0     & 4.54  & 3.15  & 5.7 \bigstrut[b]\\
			%		\hline
			%		\hline
			%		\multirow{4}[4]{*}{20} & \multirow{2}[2]{*}{Ball} & False & 35    & 40    & 0     & 0     & 0     & 132.22 & 58.21 & 225.89 \bigstrut[t]\\
			%		&       & True  & 35    & 40    & 0     & 0     & 0     & 45.86 & 20.32 & 104.49 \bigstrut[b]\\
			%		\cline{2-11}          & \multirow{2}[2]{*}{Segment} & False & 35    & 40    & 0     & 0     & 0     & 97.25 & 40.06 & 166.67 \bigstrut[t]\\
			%		&       & True  & 35    & 40    & 0     & 0     & 0     & 38.47 & 15.77 & 66.05 \bigstrut[b]\\
			%		\hline
			%		\hline
			%		\multirow{4}[4]{*}{30} & \multirow{2}[2]{*}{Ball} & False & 49    & 60    & 0     & 0     & 0     & 373.32 & 246.51 & 639.97 \bigstrut[t]\\
			%		&       & True  & 49    & 60    & 0     & 0     & 0     & 127.15 & 53.08 & 219.85 \bigstrut[b]\\
			%		\cline{2-11}          & \multirow{2}[2]{*}{Segment} & False & 49    & 60    & 0     & 0     & 0     & 414.11 & 156.76 & 979.68 \bigstrut[t]\\
			%		&       & True  & 49    & 60    & 0     & 0     & 0     & 112.68 & 50.66 & 182.82 \bigstrut[b]\\
			%		\hline
			%		\hline
			%		\multirow{4}[4]{*}{50} & \multirow{2}[2]{*}{Ball} & False & 79    & 91    & 0     & 0     & 0.01  & 1634.35 & 603.48 & 3605.13 \bigstrut[t]\\
			%		&       & True  & 79    & 91    & 0     & 0     & 0     & 553.93 & 181.13 & 1599.18 \bigstrut[b]\\
			%		\cline{2-11}          & \multirow{2}[2]{*}{Segment} & False & 79    & 91    & 0     & 0     & 0.01  & 1618.95 & 855.65 & 3604.93 \bigstrut[t]\\
			%		&       & True  & 79    & 91    & 0     & 0     & 0     & 523.08 & 152.08 & 1548.64 \bigstrut[b]\\
			%		\hline
			%		\hline
			%		\multirow{4}[4]{*}{80} & \multirow{2}[2]{*}{Ball} & False & 125   & 145   & -     & -     & -     & -     & -     & - \bigstrut[t]\\
			%		&       & True  & 125   & 145   & 0.01  & 0     & 0.02  & 3110.68 & 1976.01 & 3601.13 \bigstrut[b]\\
			%		\cline{2-11}          & \multirow{2}[2]{*}{Segment} & False & 125   & 145   & -     & -     & -     & -     & -     & - \bigstrut[t]\\
			%		&       & True  & 125   & 145   & 0.01  & 0     & 0.03  & 2835.09 & 1663.53 & 3601.26 \bigstrut[b]\\
			%		\hline
			%	\end{tabular}}%
	%	\label{tab:addlabel}%
	%\end{table}%
	
	% Table generated by Excel2LaTeX from sheet 'Hoja1'
	\begin{table}[htbp]
		\centering
		\caption{Table of computational results obtained with the formulation \eqref{form:H-TSPN}}
		\resizebox{\textwidth}{!}{
			\begin{tabular}{|c|c|c||cc|ccc|ccc|}
				\hline
				$\bm{|\mathcal N|}$ & \textbf{neighbourhood} & \textbf{preprocessing} & \multicolumn{2}{c|}{$\bm{|\mathcal B|}$} & \multicolumn{3}{c|}{\textbf{Gap}} & \multicolumn{3}{c|}{\textbf{Runtime}} \bigstrut[t]\\
				&       &       & \textbf{min} & \textbf{max} & \textbf{mean} & \textbf{min} & \textbf{max} & \textbf{mean} & \textbf{min} & \textbf{max} \bigstrut[b]\\
				\hline
				\hline
				\multirow{4}[4]{*}{5} & \multirow{2}[2]{*}{Ball} & False & \multirow{4}[4]{*}{8} & \multirow{4}[4]{*}{11} & 0.05  & 0     & 0.55  & 371.84 & 2.96  & 3600 \bigstrut[t]\\
				&       & True  &       &       & 0     & 0     & 0     & 3.46  & 1.4   & 13 \bigstrut[b]\\
				\cline{2-3}\cline{6-11}          & \multirow{2}[2]{*}{Segment} & False &       &       & 0.08  & 0     & 0.49  & 1085.48 & 0.68  & 3600 \bigstrut[t]\\
				&       & True  &       &       & 0     & 0     & 0     & 1.44  & 0.6   & 2.46 \bigstrut[b]\\
				\hline
				\hline
				\multirow{4}[4]{*}{10} & \multirow{2}[2]{*}{Ball} & False & \multirow{4}[4]{*}{15} & \multirow{4}[4]{*}{21} & 0.17  & 0     & 0.86  & 998.71 & 59.09 & 3600 \bigstrut[t]\\
				&       & True  &       &       & 0     & 0     & 0     & 36.66 & 10.72 & 87.29 \bigstrut[b]\\
				\cline{2-3}\cline{6-11}          & \multirow{2}[2]{*}{Segment} & False &       &       & 0.33  & 0     & 0.86  & 1460.31 & 16.78 & 3600 \bigstrut[t]\\
				&       & True  &       &       & 0     & 0     & 0     & 8.53  & 2.66  & 12.25 \bigstrut[b]\\
				\hline
				\hline
				\multirow{4}[4]{*}{20} & \multirow{2}[2]{*}{Ball} & False & \multirow{4}[4]{*}{35} & \multirow{4}[4]{*}{40} & 0.06  & 0.02  & 0.1   & 3600  & 3600  & 3600 \bigstrut[t]\\
				&       & True  &       &       & 0     & 0     & 0.01  & 1424.85 & 140.54 & 3600 \bigstrut[b]\\
				\cline{2-3}\cline{6-11}          & \multirow{2}[2]{*}{Segment} & False &       &       & 0     & 0     & 0.02  & 1430.13 & 166.89 & 3600 \bigstrut[t]\\
				&       & True  &       &       & 0     & 0     & 0     & 198.9 & 30.75 & 426.55 \bigstrut[b]\\
				\hline
				\hline
				\multirow{4}[4]{*}{30} & \multirow{2}[2]{*}{Ball} & False & \multirow{4}[4]{*}{49} & \multirow{4}[4]{*}{60} & 0.12  & 0     & 0.93  & 3566.2 & 3246.53 & 3600 \bigstrut[t]\\
				&       & True  &       &       & 0     & 0     & 0.02  & 2146.17 & 314.65 & 3600 \bigstrut[b]\\
				\cline{2-3}\cline{6-11}          & \multirow{2}[2]{*}{Segment} & False &       &       & 0     & 0     & 0.01  & 2119.06 & 315.56 & 3600 \bigstrut[t]\\
				&       & True  &       &       & 0     & 0     & 0     & 1140.02 & 353.73 & 3209.94 \bigstrut[b]\\
				\hline
				\hline
				\multirow{4}[4]{*}{50} & \multirow{2}[2]{*}{Ball} & False & \multirow{4}[4]{*}{79} & \multirow{4}[4]{*}{91} & 0.09  & 0.02  & 0.19  & 3600  & 3600  & 3600 \bigstrut[t]\\
				&       & True  &       &       & 0.08  & 0.01  & 0.21  & 3600  & 3600  & 3600 \bigstrut[b]\\
				\cline{2-3}\cline{6-11}          & \multirow{2}[2]{*}{Segment} & False &       &       & 0.02  & 0.01  & 0.09  & 3600  & 3600  & 3600 \bigstrut[t]\\
				&       & True  &       &       & 0.02  & 0     & 0.1   & 2956.24 & 2053.62 & 3600 \bigstrut[b]\\
				\hline
				\hline
				\multirow{4}[4]{*}{80} & \multirow{2}[2]{*}{Ball} & False & \multirow{4}[4]{*}{125} & \multirow{4}[4]{*}{145} & 0.6   & 0.42  & 0.79  & 3600  & 3600  & 3600 \bigstrut[t]\\
				&       & True  &       &       & -     & -     & -     & -     & -     & - \bigstrut[b]\\
				\cline{2-3}\cline{6-11}          & \multirow{2}[2]{*}{Segment} & False &       &       & 0.16  & 0.03  & 0.62  & 3600  & 3600  & 3600 \bigstrut[t]\\
				&       & True  &       &       & 0.61  & 0.01  & 1     & 3600  & 3600  & 3600 \bigstrut[b]\\
				\hline
				\hline
				\multirow{4}[4]{*}{100} & \multirow{2}[2]{*}{Ball} & False & \multirow{4}[4]{*}{156} & \multirow{4}[4]{*}{178} & -     & -     & -     & -     & -     & - \bigstrut[t]\\
				&       & True  &       &       & -     & -     & -     & -     & -     & - \bigstrut[b]\\
				\cline{6-11}          & \multirow{2}[2]{*}{Segment} & False &       &       & 0.53  & 0.02  & 0.99  & 3600  & 3600  & 3600 \bigstrut[t]\\
				&       & True  &       &       & 0.81  & 0.5   & 1     & 3600  & 3600  & 3600 \bigstrut[b]\\
				\hline
		\end{tabular}}%
		\label{table:results}%
	\end{table}%
	
	The same behaviour is also observed in Figure 9. The left subfigure reports the boxplot diagram for the experiments with segments as neighbourhoods, whereas the right one reports the boxplot diagram for balls as neighbourhoods. We see that preprocessing always helps since the corresponding boxes are below those without preprocessing, whenever the problems are solved well. Moreover,  we also observe in those cases where the model solves the instances  $|\mathcal{N}|\le 50$, that the problem with balls is harder than with segments since the boxes in the left subfigure are below the ones in the right subfigure.
	
	
	
	
	
	
	\input{figures/runtime_boxplot_first_experiment}
	
	\section{Concluding Remarks}
	
	This paper has dealt with two problems, the \SPPN \ and the \TSPN. In both cases, we have assumed that barriers do not allow direct movements between neighbourhoods \ref{A4}. The more general case that does not assume \ref{A4} gives rise to non-convex mixed-integer problems. It is still an open problem whether there is some kind of finite dominating set with polynomial cardinality for the version of the \TSPVN \ which could help in a simplified formulation of the problem. These questions are very interesting but beyond the scope of this paper. Needless to say, that we plan to continue its analysis in a follow-up paper.
	
	
	It would also be interesting to combine in the same model different typologies of barriers such as polygonals and second-order cone representable sets. It is also interesting to consider the single or multiple facility location problem with barriers and neighbourhoods. 
	
	All the above-mentioned problems are natural extensions of the ones considered in this paper, and  will deserve our attention in the future.
	
	\section*{Acknowledgements}
	This research has been partially supported by the Agencia Estatal de Investigación (AEI) and the European Regional Development Fund (ERDF): PID2020-114594GB-C21; Regional Government of Andalusia: projects FEDER-US-1256951, P18-FR-1422;  and Fundación BBVA: project NetmeetData (Ayudas
	Fundación BBVA a equipos de investigación científica 2019)
	
	\bibliographystyle{apa}
	\bibliography{bibliography.bib}
	
	\end{document}